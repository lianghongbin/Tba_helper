<iframe frameborder="0" src="/shipment/orders-one-pack/list?quick=103&amp;__token=eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJpYXQiOjE3NTQ0MTg5NTgsImV4cCI6MTc1NDUwNTM1OCwidXNlcklkIjoiNCIsInVzZXJDb2RlIjoi5LuT5bqT5Li7566hIiwidGVuYW50SWQiOiJ5enQiLCJzeXNDb21wYW55Q29kZSI6Im50ZXhqcnEiLCJzeXN0ZW1Db21wYW55Q29kZSI6Im50ZXhqcnEiLCJzeXN0ZW1UeXBlIjoiV01TIn0.FtqhieggM4lbGX8SFRxmGN0f79XRFbw4k6k5Wjl6ggY&amp;__tenant_id=yzt" width="100%" height="100%" id="iframe-container-103" name="iframe-container-103" class="iframe-container" allow="microphone;camera;midi;encrypted-media;fullscreen *;" style="display: block;"></iframe>

<html xmlns="http://www.w3.org/1999/xhtml"><head><script src="http://localhost:8498/CPdfPrinter.js" async=""></script><script src="http://localhost:18596/CPdfPrinter.js" async=""></script><script src="http://localhost:8596/CPdfPrinter.js" async=""></script><script src="https://localhost:8443/CLodopfuncs.js?priority=1" async=""></script>
        <meta http-equiv="content-type" content="text/html; charset=utf-8">
    <!--
    <meta http-equiv="x-ua-compatible" content="ie=7"/>
     -->
    <title>云泽通供应链</title>
    <script type="text/javascript" src="/js/jquery-1.8.3.min.js?v=stable-12.7.23"></script>
    <script type="text/javascript" src="/js/jquery-ui.min.js?v=stable-12.7.23"></script>
    <script type="text/javascript" src="/js/jquery-myProject.js?v=stable-12.7.23"></script>
    <script type="text/javascript" src="/js/jquery-myAjaxForm.js?v=stable-12.7.23"></script>
    <script language="javascript" src="/js/web-storage-cache.min.js?v=stable-12.7.23"></script>
    <script type="text/javascript" src="/js/util.js?v=20170125&amp;v=stable-12.7.23"></script>
    <script type="text/javascript">
        //获取当前语言类型
        var locale_message_language = 'zh_CN';
        var language_special_styles = ['sp_SP','mm_MM'];//需要用到某些页面上特定西班牙样式的，只需要在此添加语言便可以
        var lodopCp = '深圳市易仓科技有限公司';
var lodopKey = 'BBF40FD5AB0D522BB007D05CDE381265';
var lodopToCp = 'Shenzhen YiCang Tech Co., Ltd';
var lodopToken = '57DE71008B8E0CC51AC40BA483F50330';
var lodopHkToCp = '深圳市易倉科技有限公司';
var lodopHkToken = '0766EB432548A72C846689E86DC5A7CA';
        var timeZoneDayLight = {'Asia/Amman' : 60, 'Asia/Beirut' : 60, 'Asia/Damascus' : 60, 'Asia/Gaza' : 60, 'Asia/Hebron' : 60, 'Asia/Jerusalem' : 60, 'Asia/Nicosia' : 60, 'Asia/Tehran' : 60, 'Asia/Tel_Aviv' : 60, 'Europe/Amsterdam' : 60, 'Europe/Andorra' : 60, 'Europe/Athens' : 60, 'Europe/Belfast' : 60, 'Europe/Belgrade' : 60, 'Europe/Berlin' : 60, 'Europe/Bratislava' : 60, 'Europe/Brussels' : 60, 'Europe/Bucharest' : 60, 'Europe/Budapest' : 60, 'Europe/Busingen' : 60, 'Europe/Chisinau' : 60, 'Europe/Copenhagen' : 60, 'Europe/Gibraltar' : 60, 'Europe/Guernsey' : 60, 'Europe/Helsinki' : 60, 'Europe/Isle_of_Man' : 60, 'Europe/Jersey' : 60, 'Europe/Kiev' : 60, 'Europe/Lisbon' : 60, 'Europe/Ljubljana' : 60, 'Europe/London' : 60, 'Europe/Luxembourg' : 60, 'Europe/Madrid' : 60, 'Europe/Malta' : 60, 'Europe/Mariehamn' : 60, 'Europe/Monaco' : 60, 'Europe/Nicosia' : 60, 'Europe/Oslo' : 60, 'Europe/Paris' : 60, 'Europe/Podgorica' : 60, 'Europe/Prague' : 60, 'Europe/Riga' : 60, 'Europe/Rome' : 60, 'Europe/San_Marino' : 60, 'Europe/Sarajevo' : 60, 'Europe/Skopje' : 60, 'Europe/Sofia' : 60, 'Europe/Stockholm' : 60, 'Europe/Tallinn' : 60, 'Europe/Tirane' : 60, 'Europe/Tiraspol' : 60, 'Europe/Uzhgorod' : 60, 'Europe/Vaduz' : 60, 'Europe/Vatican' : 60, 'Europe/Vienna' : 60, 'Europe/Vilnius' : 60, 'Europe/Warsaw' : 60, 'Europe/Zagreb' : 60, 'Europe/Zaporozhye' : 60, 'Europe/Zurich' : 60, 'Africa/Ceuta' : 60, 'America/Adak' : 60, 'America/Anchorage' : 60, 'America/Atka' : 60, 'America/Bahia_Banderas' : 60, 'America/Boise' : 60, 'America/Cambridge_Bay' : 60, 'America/Chicago' : 60, 'America/Chihuahua' : 60, 'America/Dawson' : 60, 'America/Denver' : 60, 'America/Detroit' : 60, 'America/Edmonton' : 60, 'America/Ensenada' : 60, 'America/Fort_Wayne' : 60, 'America/Glace_Bay' : 60, 'America/Godthab' : 60, 'America/Goose_Bay' : 60, 'America/Grand_Turk' : 60, 'America/Halifax' : 60, 'America/Havana' : 60, 'America/Indiana/Knox' : 60, 'America/Indiana/Marengo' : 60, 'America/Indiana/Petersbu' : 60, 'America/Indiana/Tell_Cit' : 60, 'America/Indiana/Vevay' : 60, 'America/Indiana/Vincenne' : 60, 'America/Indiana/Winamac' : 60, 'America/Indianapolis' : 60, 'America/Inuvik' : 60, 'America/Iqaluit' : 60, 'America/Juneau' : 60, 'America/Kentucky/Louisvi' : 60, 'America/Kentucky/Montice' : 60, 'America/Knox_IN' : 60, 'America/Los_Angeles' : 60, 'America/Louisville' : 60, 'America/Matamoros' : 60, 'America/Mazatlan' : 60, 'America/Menominee' : 60, 'America/Merida' : 60, 'America/Metlakatla' : 60, 'America/Mexico_City' : 60, 'America/Miquelon' : 60, 'America/Moncton' : 60, 'America/Monterrey' : 60, 'America/Montreal' : 60, 'America/Nassau' : 60, 'America/New_York' : 60, 'America/Nipigon' : 60, 'America/Nome' : 60, 'America/Ojinaga' : 60, 'America/Pangnirtung' : 60, 'America/Rainy_River' : 60, 'America/Rankin_Inlet' : 60, 'America/Resolute' : 60, 'America/Santa_Isabel' : 60, 'America/Scoresbysund' : 60, 'America/Shiprock' : 60, 'America/Sitka' : 60, 'America/St_Johns' : 60, 'America/Thule' : 60, 'America/Thunder_Bay' : 60, 'America/Tijuana' : 60, 'America/Toronto' : 60, 'America/Vancouver' : 60, 'America/Whitehorse' : 60, 'America/Winnipeg' : 60, 'America/Yakutat' : 60, 'America/Yellowknife' : 60, 'Canada/Atlantic' : 60, 'Canada/Central' : 60, 'Canada/East-Saskatchewan' : 60, 'Canada/Eastern' : 60, 'Canada/Mountain' : 60, 'Canada/Newfoundland' : 60, 'Canada/Pacific' : 60, 'Canada/Yukon' : 60, 'CET' : 60, 'CST6CDT' : 60, 'Cuba' : 60, 'EET' : 60, 'EST5EDT' : 60, 'GB' : 60, 'GB-Eire' : 60, 'Iran' : 60, 'Israel' : 60, 'MET' : 60, 'Mexico/BajaNorte' : 60, 'Mexico/BajaSur' : 60, 'Mexico/General' : 60, 'MST7MDT' : 60, 'Navajo' : 60, 'Poland' : 60, 'Portugal' : 60, 'PST8PDT' : 60, 'US/Alaska' : 60, 'US/Aleutian' : 60, 'US/Central' : 60, 'US/East-Indiana' : 60, 'US/Eastern' : 60, 'US/Indiana-Starke' : 60, 'US/Michigan' : 60, 'US/Mountain' : 60, 'US/Pacific' : 60, 'US/Pacific-New' : 60, 'WET' : 60, 'America/Mexico_City' : 60, 'America/Chicago' : 60} ;  </script>
    
                <script type="text/javascript" src="https://hk-wms-oms-cdn.yunwms.com/ecwms/ntexjrq/files/2025/08/05/lang-db-wms-file-url-zh_CN.js?v=stable-12.7.23"></script>
                <script type="text/javascript">
                    if(typeof(EcLangObj) =="undefined"){
                            var EcLangObj = {};
                                EcLangObj.locale_message = $locale_message_db; 
                    }
                </script>
                    <script type="text/javascript" src="/js/locale/oms-lang-en_US.js?v=stable-12.7.23"></script>
    <script type="text/javascript" src="/js/locale/oms-lang-zh_CN.js?v=stable-12.7.23"></script>
    <script type="text/javascript" src="/js/locale/oms-lang-ru_RU.js?v=stable-12.7.23"></script>
    <script type="text/javascript" src="/js/locale/oms-lang-pt_PT.js?v=stable-12.7.23"></script>
    <script type="text/javascript" src="/js/locale/oms-lang-sp_SP.js?v=stable-12.7.23"></script>
    <script type="text/javascript" src="/js/locale/oms-lang-mm_MM.js?v=stable-12.7.23"></script>
    <script type="text/javascript" src="/js/locale/locale_message.js?v=stable-12.7.23"></script>
    <script type="text/javascript" src="/js/init.js?v=20170125&amp;v=stable-12.7.23"></script>
    <link type="text/css" rel="stylesheet" href="/css/ui-lightness/jquery-ui.min.css?v=stable-12.7.23">
            <link type="text/css" rel="stylesheet" href="/css/global.css?v=stable-12.7.23">
        <link type="text/css" rel="stylesheet" href="/css/public/index.css?v=stable-12.7.23">
        <link type="text/css" rel="stylesheet" href="/css/public/head.css?v=stable-12.7.23">
        <link type="text/css" rel="stylesheet" href="/css/public/layout.css?v=stable-12.7.23">
    <link rel="icon" href="/images/favicon.ico" type="image/x-icon">
    <link rel="shortcut icon" href="/images/favicon.ico" type="image/x-icon">
    <link type="text/css" rel="stylesheet" href="/css/public/spinners.css?v=stable-12.7.23">
<link type="text/css" rel="stylesheet" href="/js/chosen/chosen.min.css?v=stable-12.7.23">
<script type="text/javascript" src="/js/chosen/chosen.jquery.js?v=stable-12.7.23"></script>
</head>
<style>.to_top_div{display: block;position: fixed;right: -40px;bottom: 70px;z-index: 1;width: 33px;}.to_top_div .iconToTop{opacity: 0.45;}.to_top_div .iconToTop:hover{opacity: 1;}.iconToTop{background: url('/images/base/arrow-up.png') no-repeat scroll 0 0 / 30px auto rgba(0, 0, 0, 0);display: block;height: 30px;vertical-align: middle;white-space: nowrap;width: 30px;}.to_top_div .iconToBottom{opacity: 0.45;}.to_top_div .iconToBottom:hover{opacity: 1;}.iconToBottom{background: url('/images/base/arrow-down.png') no-repeat scroll 0 0 / 30px auto rgba(0, 0, 0, 0);display: block;height: 30px;vertical-align: middle;white-space: nowrap;width: 30px;margin-top: 5px;}</style><body><object id="LODOP_OB" width="0" height="0" classid="clsid:2105C259-1E0C-4534-8141-A753534CB4CA"><embed id="LODOP_EM" type="application/x-print-lodop" pluginspage="/lodop/install_lodop32.exe" width="0" height="0"></object>
<div id="mask-module" class="mask-module" style="display:none;">
    <div id="mask-module-cont">
        <img src="/images/base/progress_bar.gif" alt="loading">
        <p id="mask-text-tip">load...</p>
    </div>
</div>

<script type="text/javascript" async="" defer="" src="http://localhost:8000/CLodopfuncs.js?name=CLODOPA"></script>
<script type="text/javascript">var ecTools="1";</script>
<script type="text/javascript" async="" defer="" src="http://localhost:8498/CPdfPrinter.js"></script>
<script language="javascript" src="/lodop/LodopFuncs.js?v=20190401&amp;v=stable-12.7.23"></script>
<script type="text/javascript" src="/lodop/lodop_print.js?v=20190401&amp;v=stable-12.7.23"></script>

<script type="text/javascript" src="/js/modules/setWarehouse.js?v=201412&amp;v=stable-12.7.23"></script>
<script type="text/javascript" src="/js/cainiaoPrint.js?v=stable-12.7.23"></script>
<script type="text/javascript">

var skuIntercept = '';//ID1036626 sku扫描时是否支持%%截取（lixichu add）
var has_serial = false;

var _PACK_AUTO_AUDIO = '0';
var PRODUCT_SERIAL_INOUT = '0';
var IS_PACK = '0';
var isShowBoxMoreSku = '';
if(isShowBoxMoreSku == '' || isShowBoxMoreSku == undefined) {
    isShowBoxMoreSku = 0;
}
var orderExceptionSubTypeJson={"2":{"oest_id":"2","oest_type":"1","oest_sort":"0","oest_status":"1","oest_name":"\u5b9e\u7269\u5e93\u5b58\u4e0d\u8db3","oest_name_en":"\u5b9e\u7269\u5e93\u5b58\u4e0d\u8db3","oest_app":"2","oest_name_pt":""},"3":{"oest_id":"3","oest_type":"1","oest_sort":"0","oest_status":"1","oest_name":"\u5305\u88f9\u5df2\u8d85\u91cd\u65e0\u6cd5\u7b7e\u51fa(\u9700\u8981\u66f4\u6362\u6e20\u9053)","oest_name_en":"\u5305\u88f9\u5df2\u8d85\u91cd\u65e0\u6cd5\u7b7e\u51fa(\u9700\u8981\u66f4\u6362\u6e20\u9053)","oest_app":"3","oest_name_pt":""},"5":{"oest_id":"5","oest_type":"1","oest_sort":"0","oest_status":"1","oest_name":"\u5176\u4ed6","oest_name_en":"\u5176\u4ed6","oest_app":"8","oest_name_pt":"outros"},"6":{"oest_id":"6","oest_type":"1","oest_sort":"0","oest_status":"1","oest_name":"\u5176\u4ed6","oest_name_en":"\u5176\u4ed6","oest_app":"8","oest_name_pt":"outros"}};
var _showProductImg = '1';
EZ.orderCode='订单号';
var canSerialNumber = '';
var PICKING_SELECT_PRODUCT = '0';


var warehouseUnitEnable='0';

var is_pack_and_weight = 0 ;
var volType = 0;
var operation_warehouse = 0;

var had_operate_ship_order = 0;
var had_batch_packed = 0;
var packageCode = 'P000001';
var not_print_on_package_to_order = '0';
var is_serial_number_checked = '0';
var hide_sku_line = '0';
var hideSkuLineBefore = '0';
var can_scan_serial_number = '0';
var setSerial = 1;

var isPrintOutTheLibraryList = '0';

var isPrintOthersAttach = '0';

var isUseEccangAssistant = '0';
var ToolAppSecret = 'becba288659edcf33198b51c3b231315';
var domain = 'http://yzt.wms.yunwms.com/default/app/tools';

function alertMessage(thtml) {
    $("#operation-message").html(thtml).css("color","red");
}

$(function () {
    if(parseInt(not_print_on_package_to_order) == 0){
        $("#isPrintLabel").attr("checked", true);
        $("#is_print_on_package_to_order").attr("checked", false);
    }else{
        $("#isPrintLabel").attr("checked", false);
        $("#is_print_on_package_to_order").attr("checked", true);
    }


    if(parseInt(is_serial_number_checked) == 1){
        $("#is_serial_number_checked").attr("checked", true);
    }else{
        $("#is_serial_number_checked").attr("checked", false);
    }

    if(hide_sku_line == 1){
        $("#product_barcode_show").hide();
    }else{
        $("#product_barcode_show").show();
    }

    $("#package_select").chosen({search_contains:true, width:"345px"});
    if((packageCode != '') && (packageCode != null)){
        $("#package_select").val(packageCode).trigger("chosen:updated");
    }

    $("#isPdfPrinter").live('click', function(){
        if ($(this).is(":checked") && typeof(pdfPrinter) != "object") {
            $.getScript("http://localhost:8498/CPdfPrinter.js");
        }
    });
    if(getCPDFPrinterStatus() && typeof(pdfPrinter) == "object") {
        $("#isPdfPrinter").attr('checked', 'checked');
    }

    if(parseInt(isUseEccangAssistant)==1){
        $("#isPdfPrinter").attr("checked", true);
        $("#isPdfPrinter").attr("disabled", true);
    }

    $('#serial').on('click',function () {
        $(this).select();
    });

    $('.submitSerial').on('click',function () {
        var serial = $.trim($("#serial").val());
        $("#serial").val(serial);

        getSerial($.trim($('#productBarcode').val()));
    });

    $('#serial').keyup(function (e) {
        var key = e.which;
        if (key == 13) {
            var serial = $.trim($("#serial").val());
            $("#serial").val(serial)
            getSerial($.trim($('#productBarcode').val()));
        }
    });

    $('.submitProduct').click(function () {
        var str = getScanProductBarcode($("#productBarcode").val());
        $('#productBarcode').val(str);
        getSerial($.trim($('#productBarcode').val()));
    });
    $("#module-container").click(function(event){
            if(event.target.id === "check-button-div-show" || event.target.id === "check-button-div") {
                // 输入框点击事件处理
                if(event.target.id === "check-button-div-show"){
                    if($('.check-button-div-hidden').size() >= 1){
                        $('.check-button-div').removeClass('check-button-div-hidden');
                    }else{
                        $('.check-button-div').addClass('check-button-div-hidden');
                    }
                }
            } else if(!(event.target.id == 'PrintBillOfMaterialsList' || event.target.id == 'isPdfPrinter' || event.target.id == '')) {
                // 空白处的点击事件处理
                if($('.check-button-div-hidden').size() < 1){
                    $('.check-button-div').addClass('check-button-div-hidden');
                }
            }
    });



    $("#pickingCode", "#searchForm").focus();
    $(".submitPicking", "#searchForm").click(function () {
        alertMessage('');
        var pickingCode = $.trim($("#pickingCode").val());
        if (pickingCode == "") {
            alertMessage($.getMessage('please_enter_picking_single'));
            $("#pickingInfo").hide();
            return false;
        }

        if(parseInt(isUseEccangAssistant)==1 && (getCPDFPrinterStatus() ===false || typeof (pdfPrinter) != "object")) {
            alertTip('请先连接打印小助手，再操作！');
            return false;
        }

        var warehouseId = $.cookie('current_operation_warehouse');
        $("#batchPackDiv").hide();
        $("#pickingInfo").hide();
        $("#weighting_ship_div").hide();
        EZ.listDate.myLoading();
        $("#order_no_remark").text('');
        $("#shop_name").text('');
        $("#carriers_name").text('');
        var html = '';
        $.ajax({
            type: "post",
            async: false,
            dataType: "json",
            url: "/shipment/orders-one-pack/get-picking?pickingCode=" + pickingCode + "&warehouseId="+warehouseId,
            success: function (json) {
                if (json.state == 1) {
                    $("#pickingInfoPickingCode").text(json.pickingCode);
                    $("#pickingInfoPickingScanQty").text(json.data.finish);
                    $("#pickingInfoPickingQty").text(json.data.scanQty);
                    $("#pickingInfo").show();
                    $("#table-module-list-data").EzWmsSetSearchData({state: 1});

                    if(!$("#fixedPackage").is(":checked") && typeof json.defaultPackage == 'string' && json.defaultPackage != '') {
                        $("#packingCode").val(json.defaultPackage);
                        $("#package_select").val(json.defaultPackage).trigger("chosen:updated");
                    }

                    //开放 下载按钮
                    $(".divOrderAttach").show();
                    if(hide_sku_line == 1){
                       isFocus(5);
                    }else{
                       isFocus(2);
                    }

                } else {
                    $.each(json.error, function (key, val) {
                        html += '<span class="tip-error-message">' + val + '</span>';
                    });
                    alertMessage(html);
                    $("#table-module-list-data").EzWmsSetSearchData({state: 1});
                    isFocus(1);
                }
            }
        });
    }).focus(function () {
               $("#pickingCode").select();
            });




    //输入重量，回车，执行签出
    $("#so_weight").keyup(function (e) {
        var key = e.which;
        if (key == 13) {
            $(".submitShip").click();
        }
    });

    //确认签出
    $(".submitShip", "#searchForm").click(function () {
        var pp_float = /^\d+(\.\d+)?$/;
        var so_weight = $.trim($("#so_weight").val());
        if (so_weight == '') {
            alertMessage("请输入重量");
            $("#so_weight").select();
            isFocus(4);
            return;
        }

        if (!pp_float.exec(so_weight) || parseFloat(so_weight)<=0) {
            alertMessage("操作失败：重量数据异常,请确认");
            $("#so_weight").select();
            isFocus(4);
            return;
        }

        var orderCode = $("#ship_order_code").val();
        var is_force = $("#is_force").val();
        var ship_sm_code = $("#ship_sm_code").val();
        var tracking_number = $("#ship_tracking_number").val();

        //签出
        $.ajax({
            type: "POST",
            async: false,
            dataType: "json",
            url: '/shipment/orders/scan-delivery',
            data: {'sc_code':ship_sm_code,'order_code':orderCode, 'o_weight':so_weight, 'ship_code':tracking_number, 'is_force':is_force},
            success: function (json) {
                if (!isJson(json)) {
                    $('#is_force').val(0);
                    alertMessage("err 500");
                    return;
                }

                if (json.state == '1') {
                    $('#is_force').val(0);
                    var is_focus_code = $("#is_focus_code").val();

                    alertMessage('出货成功：(' + json.detail.E2 + ')');
                    $("#so_weight").val('');
                    $("#weighting_ship_div").hide();
                    $("#weighting_ship_new_div").hide();
                    $("#ship_order_code").val('');
                    $("#ship_sm_code").val('');
                    $("#ship_tracking_number").val('');
                    $("#is_focus_code").val('');

                    isFocus(is_focus_code);
                    if (is_focus_code == '2') {
                        $("productBarcode").select();
                        isFocus(2);
                    }

                } else if (json.state == '2') {
                    var message = json.message + ',您确定要出货吗？';
                    $('<div title="操作提示" class="dialog-confirm-del-alert-tip"><p style="color:red;">'+json.message+'</p></div>').dialog({
                        autoOpen: true,
                        width: '320',
                        height: 'auto',
                        modal: true,
                        show: 'slide',
                        buttons: {
                            [$.getMessage("confirm")]: function() {
                                $(this).dialog('close');
                                $('#is_force').val(1);
                                $(".submitShip").click();
                            },
                            [$.getMessage("cancel")]: function() {
                                $('#o_weight').focus();
                                $(this).dialog('close');
                            }
                        }
                    });
                } else {
                    $('#is_force').val(0);
                    alertMessage(json.message);
                    $("#so_weight").select();
                    isFocus(4);
                    return false;
                }
            }
        });

    });


    $(".confirmPack", "#searchForm").click(function () {
        alertMessage('');
        getSerial($.trim($('#productBarcode').val()));
    });


    $(".batchPack", "#searchForm").click(function () {
        if(had_operate_ship_order == 1){
            alertTip('拣货单部分订单已经操作称重签出，不支持批量打包');
            return false;
        }
        if($("#batchPackConfirm").is(":checked")) {
            var qty=$("#batchPackQty").val();
            alertConfirmTip('共'+qty+'个订单，确认批量操作吗?',batchSubmitPack);
        } else {
            batchSubmitPack();
        }
    });

    $("#scanPickingCode", "#searchForm").click(function () {
        if($(this).is(":checked")){
            $("#pickingCode").removeAttr("disabled");
            isFocus(1);
        }else{
            $("#pickingCode").val('').attr("disabled","disabled");
            isFocus(2);
        }
    });

    $("#pickingCode").keyup(function (e) {
        var key = e.which;

        if (key == 13) {
          //通知易仓打印助手打印标签
          var isPdfPrinter = $("#isPdfPrinter:checked").size();
          var pickCode = $.trim($('#pickingCode').val());
          $('#pickingCode').val(pickCode)

          if (isPdfPrinter && getCPDFPrinterStatus() && pickCode != '') {
            try {
              console.log('to ecTools' + pickCode);
              pdfPrinter.NotifyPk(pickCode);
            } catch (err) {
              console.log(err);
            }
          }

          $(".submitPicking").click();
        }
    });
    $("#pallet_code").keyup(function (e) {
        var key = e.which;
        if (key == 13) {
            $.ajax({
                type: "post",
                async: false,
                dataType: "json",
                url: "/shipment/pick/get-picking-code-by-pallet",
                data:{
                    pallet_code:$('#pallet_code').val()
                },
                success: function (json) {
                    $("#pallet_code").focus().select();
                    if(json.state==1 && json.data){
                        $("#pickingCode").val(json.data);
                        //通知易仓打印助手打印标签
                        var isPdfPrinter = $("#isPdfPrinter:checked").size();
                        var pickCode = $('#pickingCode').val();
                        if (isPdfPrinter && getCPDFPrinterStatus() && pickCode != '') {
                            try {
                                console.log('to ecTools' + pickCode);
                                pdfPrinter.NotifyPk(pickCode);
                            } catch (err) {
                                console.log(err);
                            }
                        }

                        $(".submitPicking").click();
                    }
                }
            });

    }});
    var $packingCode = $('#packingCode');
    $packingCode.keyup(function (e) {
        var key = e.which;
        if (key == 13) {
            $(".confirmPack").click();
        }
    });
    var $packageSelect = $('#package_select');
    $('#fixedPackage').change(function(){
        if($(this).is(":checked")){

            if(($packageSelect.val() == '') || ($packageSelect.val() == null)){
                $(this).attr('checked',false);
                alertTip('请选择包裹');
            }else{
                $('#package_select').attr('disabled',true).trigger('chosen:updated');
                $packingCode.val($packageSelect.val()).attr('readonly',true);
            }
        }else{
            $packingCode.attr('readonly',false);
            $('#package_select').attr('disabled',false).trigger('chosen:updated');
        }
    });

    $packageSelect.change(function(){
        var select_package = $packageSelect.val();
        if((select_package != null) && (select_package != '')){
            var select_package_str = select_package.join(',');
        }
        $packingCode.val(select_package_str);
    });



    //未配货SKU
    $('#waitingDataDialog').dialog({
        autoOpen: false,
        width: 750,
        modal: true,
        show: "slide",
        buttons: [
            {
                text:$.getMessage("close"),
                click: function () {
                    $(this).dialog("close");
                }
            }
        ],
        close: function () {
            $("#waiting-list-data").html('');
            isFocus(2);
        }
    });

    //已扫描SKU
      $('#hadScanDataDialog').dialog({
            autoOpen: false,
            width: 650,
            modal: true,
            show: "slide",
            buttons: [
                {
                    text:$.getMessage("close"),
                    click: function () {
                        $(this).dialog("close");
                    }
                }
            ],
            close: function () {
                $("#had-scan-list-data").html('');
                isFocus(2);
            }
      });

    //回车处理
    $("#productBarcode").keyup(function (e) {
        var key = e.which;
        if (key == 13) {
            var str = getScanProductBarcode($(this).val());
            $(this).val(str);
            getSerial($.trim($('#productBarcode').val()));
        }
    });


    function getScanProductBarcode(code) {
        var str = code;
        str = str.toUpperCase();
        str = str.trim();
        var val = str.replace(/\s+/g,'_');
        if(skuIntercept == '1'){
            var pos = val.indexOf("%");
            if(pos != -1){
                var interception = val.substr(0,pos);
                val = interception;
            }
        }
        return val;
    }





    function getTestProduct(pickingCode,productBarcode){
        $("#pickingProductBarcode").val('');  //优先重置为空
        alertMessage('');
        $.ajax({
            type: "post",
            async: false,
            dataType: "json",
            url: "/shipment/orders-pack/get-picking-barcode",
            data: {
                "pickingCode": pickingCode,
                "productBarcode": productBarcode
            },
            success: function (json) {
                if (isJson(json)) {
                    if (json.state == '1') {
                        //调弹出框让客户选择
                        var html = "";
                        $.each(json.data, function (key, val) {
                            html += (key + 1) % 2 == 1 ? "<tr class='table-module-b1'>" : "<tr class='table-module-b2'>";
                            html += "<td class='ec-center'>" + (key + 1) + "</td>";
                            html += "<td class=''><span class='waitingDataSkuCssNew'>" + val.customer_code + "</span></td>";
                            html += "<td class=''><span class='waitingDataSkuCssNew'>" + val.product_sku + "</span></td>";
                            html += "<td class=''><span class='waitingDataSkuCssNew'>" + val.product_barcode + "</span></td>";
                            html += "<td class=''><span class='waitingDataSkuCssNew'><input type='radio' name = 'getPickingSku' class='single_input' id='getPickingSku_"+val.product_id+"' value='"+val.product_barcode+"'></span></td>";
                            html += "</tr>";
                        });

                        $("#waiting-picking-sku-data").html(html);
                        $('#waitingPickingSkuDialog').dialog("open");   //开启弹框

                    }else if(json.state == '2'){
                        //表示只有一条数据，不在开启弹框，直接赋值
                        var onedata = json.data.shift();
                        $("#productBarcode").val(onedata.product_barcode);
                        //这里传递的productBarcode是选择后的产品代码
                        configOperaGetSerial($("#productBarcode").val());
                    }else{
                        alertMessage(json.message);
                        return false;
                    }
                }
            }
        });
    }


    //点击单选框，赋值
    $('.single_input').live('click',function () {
        //点击清空除自己的radio;然后将点击的数据focus到sku
        var data = $(this).attr("value");
        if(!data){
            alertMessage('please select productBarcode');
            return false;
        }
        $("#productBarcode").val(data);

        $("#pickingProductBarcode").val(data);  //用于判断是否点击选择了
        alertMessage('');  //请空提示

    });





    //客户选择产品弹框 - 开启，关闭
    $('#waitingPickingSkuDialog').dialog({
        autoOpen: false,
        width: 650,
        modal: true,
        show: "slide",
        buttons: [
            {
                text: $.getMessage('cancel'),
                click: function () {
                    $(this).dialog("close");
                }
            },
            {
                text:$.getMessage("confirm"),
                click: function () {
                    var bCode = $("#pickingProductBarcode").val();
                    if(!bCode){
                        alertMessage('please select productBarcode');
                        return false;
                    }

                    alertMessage('');  //请空提示
                    $(this).dialog("close");
                    //这里传递的productBarcode是选择后的产品代码
                    configOperaGetSerial($("#productBarcode").val());
                }
            }

        ],
        close: function () {
            $("#waiting-picking-sku-data").html('');
            isFocus(2);
        }
    });





    //把原getSerial方法的代码重命名再次封装一次
    function configOperaGetSerial(productBarcode){
        if(productBarcode == ''){
            alertMessage("产品编码 必填");
            return;
        }

        //【ID1075464】先判断输入的是否外箱条码，如果是外箱条码就将外箱条码转为产品代码
        var product_outer_code = productBarcode;
        var scan_number = 1;
        var outer_code = '';
        $.ajax({
            type : 'POST',
            async: false,
            url  : '/shipment/orders-pack/get-product-barcode-by-outercode',
            data : { 'code':productBarcode, 'picking_code':$('#pickingCode').val() },
            dataType: 'json',
            success : function(json){
                if(parseInt(json.state) == 1){
                    $("#productBarcode").val(json.data.product_code);
                    productBarcode = json.data.product_code;
                    scan_number = parseInt(json.data.number);
                    outer_code = product_outer_code;
                } else if (json.is_ean && json.is_ean_more_sku) {
                    var item_ean_products = json.item_ean_products || [];
                    if (item_ean_products) {
                        $.each(item_ean_products, function (i, v) {
                            // todo 处理多 SKU 的情况
                        });
                    }
                }
            }
        });

    //【ID1113070】WMS-》WMS端-【出货管理】-【打包管理】-【按SKU打包】支持只扫描序列号进行打包操作


    var serial_number = productBarcode;
    var serialError = 0;
    var serialErrMsg = '';
    setSerial = 1 ;
    if(can_scan_serial_number == 1){
        $.ajax({
            type : 'POST',
            async: false,
            url  : '/shipment/orders-pack/get-product-barcode-by-serialnumber',
            data : { 'code':serial_number, 'picking_code':$('#pickingCode').val() },
            dataType: 'json',
            success : function(json){
                if(parseInt(json.state) == 1){
                    $("#productBarcode").val(json.data.product_barcode);
                    $("#serial").val(serial_number);
                    productBarcode = json.data.product_barcode;
                    serialError = json.show_error;
                    setSerial = 0;
                }else{
                    serialError = json.show_error;
                    serialErrMsg = json.message;
                }
            }
        });
    }
    if(serialError){
        alertMessage(serialErrMsg);
        return false;
    }

        var params = { 'code':productBarcode,'order_code':$("#orderCode").val(),'picking_code':$('#pickingCode').val() };

        //增加是否扫描序列号配置
        if(canSerialNumber == '1' || canSerialNumber == 5){
            //判断序列号是否存在
            if($("#is_serial").attr('checked') =='checked'){
                var serial = $("#serial").val();
                if(serial.length <1){
                    $('#serial').focus();
                    $('#operation-message').text('请输入序列号');
                    $('#operation-message').css('color', 'red');
                    // alertTip("<span class='tip-error-message'>操作失败：请输入序列号</span>");
                    return false;
                }else{
                    params.is_serial = 1;//是否扫描序列号 1 是 0 否
                    params.serial = serial;//序列号
                }
            }
        }else if(canSerialNumber == '2') {  //增加自动检测产品序列号中是否有已收货状态的序列号  --author by meidaochun
            params.is_serial = 2; //是否扫描序列号 1 是 0 否 2 自动检测序列号是否扫描序列号
        }

        if($('#packingCode').val() == ''){
            alertMessage("请输入包材代码");
            isFocus(3);
            return;
        }
        $.post('/shipment/orders-pack/get-serial',params,function (json) {
            json = $.parseJSON(json);
            if(json.state == 1){
                if(json.message == 'serial'){
                    $('#serial').focus();
                    if(canSerialNumber ==6) {
                        $("#is_serial").attr('checked', true);
                        var serial = $("#serial").val();
                        if(serial.length <1){
                            $('#serial').focus();
                            $('#operation-message').text('请输入序列号');
                            $('#operation-message').css('color', 'red');
                            // alertTip("<span class='tip-error-message'>操作失败：请输入序列号</span>");
                            return false;
                        }else{
                            params.is_serial = 1;//是否扫描序列号 1 是 0 否
                            params.serial = serial;//序列号
                        }
                    }
                    if($('#serial').val() == ''){
                        alertMessage('请输入serial_number');
                    }else{
                        submitSerial();
                    }
                }else if(json.message == 'serial_receiving') {
                    //自动检测是否扫描序列号
                    $('#is_serial').attr('checked','checked');
                    if($('#serial').val() == '') {
                        $('#serial').focus();
                        $('#operation-message').text('请输入序列号');
                        $('#operation-message').css('color', 'red');
                        return false;
                    }else{
                        submitSerial();
                    }
                }else{
                    if(canSerialNumber ==6) {
                        $("#is_serial").attr('checked', false);
                    }
                    //将扫描的外箱条码信息添加到表单中便于后面打包时候提交
                    if((parseInt(scan_number) > 0) && (outer_code != '')){
                        addOuterIntoForm(outer_code, scan_number);
                    }

                    has_serial = true;
                    scanProduct(scan_number);
                }
            }else{
                if (_PACK_AUTO_AUDIO==1) {
                    autoPlayFail();
                }
                alertMessage(json.message);
            }
        });
    }



    function getSerial(productBarcode) {
        //如果 满足hide_sku_line 逻辑 直接输入序列号 绑定序列号后校验
        var pickingCode=$.trim($("#pickingCode").val());
        if(hide_sku_line == 1){
             judgeSerialNumber(pickingCode);
        }else{
            //在这里进行操作弹出框,开启配置则走这个逻辑
            if(PICKING_SELECT_PRODUCT == 1){
                getTestProduct(pickingCode,productBarcode);
            }else{
                configOperaGetSerial(productBarcode);
            }
        }
    }

    function judgeSerialNumber(pickingCode){
         var serialNumber = $.trim($("#serial").val());
        $("#serial").val(serialNumber);

         if(!serialNumber){
            $('#operation-message').text('请输入序列号代码');
            $('#operation-message').css('color', 'red');
            return false;
         }else{
             $('#operation-message').text('');
         }
         $.ajax({
            type: "post",
            async: false,
            dataType: "json",
            url: "/shipment/orders-pack/judge-serial-number",
            data: {
                "pickingCode": pickingCode,
                "serialNumber": serialNumber,
                "sku_pack": 1,
            },
            success : function(json){
                if(parseInt(json.state)){
                    $('#operation-message').text('');
                    $("#productBarcode").val(json.product_barcode)
                    configOperaGetSerial(json.product_barcode);

                }else{
                    $('#operation-message').text(json.message);
                    $('#operation-message').css('color', 'red');
                    return false;
                }
            }
         });

    }

    //功能设置弹窗
    $('#function_settings_dialog').dialog({
        autoOpen: false,
        width: 650,
        modal: true,
        show: "slide",
        buttons: [
            {
                text:$.getMessage("confirm"),
                click: function () {
                    var serial_number_check = 0;
                    var function_settings_check =  $("#is_serial_number_checked:checked").val();

                    if(function_settings_check == '1'){
                        serial_number_check = 1;
                    }
                    var params = [];
                    params.push({type: "SERIAL_NUMBER_BY_SKU_PACKAGING", value: serial_number_check});
                    $.ajax({
                        async : false,
                        type  : 'post',
                        url   : '/shipment/orders-pack/print-setting',
                        data  : {params},
                        dataType : 'json',
                        success  : function(json){
                            if(parseInt(json.state)){
                                if(serial_number_check){
                                    $("#is_serial_number_checked").attr("checked", true);
                                }else{
                                    $("#is_serial_number_checked").attr("checked", false);
                                }
                                if(hideSkuLineBefore == 1 && serial_number_check == 1){
                                    hide_sku_line = 1;
                                    $("#product_barcode_show").hide();
                                }else{
                                    hide_sku_line = 0;
                                    $("#product_barcode_show").show();
                                }
                            }else{
                                //更新失败就还原
                                if(serial_number_check){
                                    $("#is_serial_number_checked").attr("checked", false);
                                }else{
                                    $("#is_serial_number_checked").attr("checked", true);
                                }
                            }

                            alertTip(json.message);
                            $('#function_settings_dialog').dialog("close");
                            setTimeout(function(){
                                $('#dialog-auto-alert-tip').dialog("close");
                            },1000)
                            // $('#function_settings_dialog').dialog("close");
                            // //保存完毕后加载页面,否则配置可能不生效
                            // setTimeout(function(){
                            //     window.location.reload();
                            // },1000)

                        }
                    });
                }
            },
            {
                text:$.getMessage("close"),
                click: function () {
                    $(this).dialog("close");
                }
            }
        ],
        close: function () {
            $(this).dialog("close");
        }
    });


    //功能设置弹窗
    $('#function_settings_dialog').dialog({
        autoOpen: false,
        width: 650,
        modal: true,
        show: "slide",
        buttons: [
            {
                text:$.getMessage("confirm"),
                click: function () {
                    var not_print_check = 0;
                    var function_settings_check =  $("#is_print_on_package_to_order:checked").val();

                    if(function_settings_check == '1'){
                        not_print_check = 1;
                    }

                    var serial_number_check = 0;
                    var function_settings_check =  $("#is_serial_number_checked:checked").val();

                    if(function_settings_check == '1'){
                        serial_number_check = 1;
                    }
                    var params = [];
                    params.push({type: "NOT_PRINT_BY_SKU_PACKAGING", value: not_print_check});
                    params.push({type: "SERIAL_NUMBER_BY_SKU_PACKAGING", value: serial_number_check});
                    $.ajax({
                        async : false,
                        type  : 'post',
                        url   : '/shipment/orders-pack/print-setting',
                        data  : {params},
                        dataType : 'json',
                        success  : function(json){
                            if(parseInt(json.state)){
                                if(not_print_check){
                                    $("#isPrintLabel").attr("checked", false);
                                }else{
                                    $("#isPrintLabel").attr("checked", true);
                                }
                                if(hideSkuLineBefore == 1 && serial_number_check == 1){
                                    hide_sku_line = 1;
                                    $("#product_barcode_show").hide();
                                }else{
                                    hide_sku_line = 0;
                                    $("#product_barcode_show").show();
                                }
                            }else{
                                //更新失败就还原
                                if(not_print_check){
                                    $("#isPrintLabel").attr("checked", true);
                                }else{
                                    $("#isPrintLabel").attr("checked", false);
                                }
                            }

                            alertTip(json.message);
                            $('#function_settings_dialog').dialog("close");
                            setTimeout(function(){
                                $('#dialog-auto-alert-tip').dialog("close");
                            },1000)
                            // $('#function_settings_dialog').dialog("close");
                            // //保存完毕后加载页面,否则配置可能不生效
                            // setTimeout(function(){
                            //     window.location.reload();
                            // },1000)
                        }
                    });
                }
            },
            {
                text:$.getMessage("close"),
                click: function () {
                    $(this).dialog("close");
                }
            }
        ],
        close: function () {
            $(this).dialog("close");
        }
    });



    //订单附件
    $('.orderAttach').live('click',function(){
        var picking_code = $.trim($("#pickingCode").val());

        if(picking_code == ''){
            alertTip('拣货单号不能为空');
            return false;
        }

        var req_url = '/order/orders/attachment-edit-picking-code?picking_code='+picking_code;

        if(language_special_styles.indexOf(locale_message_language) !== -1){
            var w = 1600;
        }else{
            var w = parent.windowWidth()-300;
        }
        var h = parent.windowHeight()-280;
        openIframeDialogForCustom(req_url,w,h,'订单附件','orders-attached-show-dialog');

    });

       //换算
    $('.system_unit').live('keyup',function(){
        var value = $(this).val(),type = $(this).attr('data-type'),unit_type = $(this).attr('data-unit_type'),attr = $(this).attr('data-attr');
        unitSwitch($(this),value,operation_warehouse,attr,unit_type,type);
        // var sysUnit = util.getWarehouseSizeUnit(0);
        var wareUnit = util.getWarehouseSizeUnit(00);
    });
    $('.warehouse_unit').live('keyup',function(){
        var value = $(this).val(),type = $(this).attr('data-type'),unit_type = $(this).attr('data-unit_type'),attr = $(this).attr('data-attr');
        unitSwitch($(this),value,operation_warehouse,attr,unit_type,type);
    });
    //计算箱子体积
    var parcelMeasureVol = 0;
    $('.measure_all').delegate('.parcel_measure','keyup',function(){
        //显示的体积重
        var warehouseMeasureVol = 0;
        var volRate = $("input[name='vol_rate']").val();
        volRate = (volRate > 0 ) ? volRate : 0;

        setTimeout(function () {
            var parcel_length = parseFloat($('#parcel_length_input').val());
            var parcel_width = parseFloat($('#parcel_width_input').val());
            var parcel_height = parseFloat($('#parcel_height_input').val());

            if (isPerimeter()) {
                parcelMeasureVol = volRate > 0 ? (parcel_length + parcel_width + parcel_height) / volRate : 0;
            } else {
                parcelMeasureVol = volRate > 0 ? parcel_length * parcel_width * parcel_height / volRate : 0;
            }

            //先展示系统级 （KG）
            var system_vol_weight = parseFloat(parcelMeasureVol) > 0 ? parseFloat(parcelMeasureVol) : 0.000
            $('#parcel_vol_weight').html(system_vol_weight.toFixed(3));
            $('#parcel_vol_weight_input').val(system_vol_weight.toFixed(3));

            if (warehouseUnitEnable == 1 || warehouseUnitEnable == 2) { //转换仓库单位
                warehouseMeasureVol = util.getWarehouseWeightValue(parcelMeasureVol, operation_warehouse);
                warehouseMeasureVol = parseFloat(warehouseMeasureVol) > 0 ? parseFloat(warehouseMeasureVol) : 0.000;
                $('#parcel_vol_warehouse_weight').html(warehouseMeasureVol.toFixed(3));
                $('#parcel_vol_warehouse_weight_input').val(warehouseMeasureVol.toFixed(3));
            }
        }, 200);
    });

    $(".parcel_measure").keypress(function (e) {
        if(e.which==13){
            $(this).next().select().focus();
        }
    });



    //输入系统重量，回车，执行签出
   $('#o_weight').live('keyup',function(e){
       if(warehouseUnitEnable == '1' || warehouseUnitEnable == '2'){
           $('#warehouse_weight').val(util.getWarehouseWeightValue($(this).val(),operation_warehouse));
       }
       if(e.keyCode===13) {
           delivery();
           return false;
       }
   });

    //输入系统仓库重量，回车，执行签出
   $('#warehouse_weight').live('keyup',function(e){
       if(warehouseUnitEnable == '1' || warehouseUnitEnable == '2'){
           $('#o_weight').val(util.getSystemWeightValue($(this).val(),operation_warehouse));
       }
       if(e.keyCode===13) {
           delivery();
           return false;
       }
   });

     $(".submitShipOrder").click(function () {
          delivery();
     });


    getNowSelectedWarehouse(function (value) {
        if (value == null) {
            return ;
        }
        var html =  value.warehouse_code  + "&nbsp;&nbsp;" + '['+value.warehouse_desc+']';
        $("#selectedWarehouse").html(html);
    })



    if(parseInt(isPrintOutTheLibraryList) == 1){
        $("#PrintOutTheLibraryList").attr("checked", true);
    }else{
        $("#PrintOutTheLibraryList").attr("checked", false);
    }

    if(parseInt(isPrintOthersAttach) == 1){
        $("#PrintOtherDocumentsAttach").attr("checked", true);
    }else{
        $("#PrintOtherDocumentsAttach").attr("checked", false);
    }

     $('#PrintOutTheLibraryList').change(function(){
        var PrintOutTheLibraryList = $("input[name='PrintOutTheLibraryList']:checked").val();
        var params = [];
        params.push({type: "ORDERS_ONE_PACK_LIBRARY_LIST", value: PrintOutTheLibraryList});
        //更新数据
        $.ajax({
        async : false,
        type  : 'post',
        url   : '/shipment/orders-pack/print-setting',
        data  : { params },
        dataType : 'json',
        success  : function(json){
        if(parseInt(json.state)){
        if(PrintOutTheLibraryList){
        $("#PrintOutTheLibraryList").attr("checked", true);
        }else{
            $("#PrintOutTheLibraryList").attr("checked", false);
        }
        }else{
            //更新失败就还原
            if(PrintOutTheLibraryList){
            $("#PrintOutTheLibraryList").attr("checked", false);
        }else{
            $("#PrintOutTheLibraryList").attr("checked", true);
        }
        }
            // alertTip(json.message);
        }
        });
     });

    $('#PrintOtherDocumentsAttach').change(function(){
        var PrintOtherDocumentsAttach = $("input[name='PrintOtherDocumentsAttach']:checked").val();
        var params = [];
        params.push({type: "ORDERS_ONE_PACK_PRINT_OHTER_ATTACH", value: PrintOtherDocumentsAttach});
        //更新数据
        $.ajax({
            async : false,
            type  : 'post',
            url   : '/shipment/orders-pack/print-setting',
            data  : { params },
            dataType : 'json',
            success  : function(json){
                if(parseInt(json.state)){
                    if(PrintOtherDocumentsAttach){
                        $("#PrintOtherDocumentsAttach").attr("checked", true);
                    }else{
                        $("#PrintOtherDocumentsAttach").attr("checked", false);
                    }
                }else{
                    //更新失败就还原
                    if(PrintOtherDocumentsAttach){
                        $("#PrintOtherDocumentsAttach").attr("checked", false);
                    }else{
                        $("#PrintOtherDocumentsAttach").attr("checked", true);
                    }
                }
                // alertTip(json.message);
            }
        });
    });



});


//把扫描的产品外箱条码信息添加到表单中
function addOuterIntoForm(code, number){
    if((code != '') && (parseInt(number) > 0)){
        var exist_flag = false;
        $(".outer_info").each(function(k,obj){
            var name = $(this).attr("name");
            var value = $(this).val();

            if(name == code){
                var new_number = parseInt(number) + parseInt(value);
                $(this).val(new_number);

                exist_flag = true;
            }
        });

        if(!exist_flag){
            var outer_html = "<input type='hidden' class='outer_info' name='"+code+"' value='"+number+"'>";
            $("#product_outer_info").append(outer_html);
        }
    }
}





function scanProduct(scan_number) {
    alertMessage('');
    alertMessageDelivery('',0);
    $("#batchPackDiv").hide();
    $("#weighting_ship_div").hide();
    $("#weighting_ship_new_div").hide();
    $("#table-module-list-data").EzWmsSetSearchData({state: 1});
    var productBarcode = $.trim($("#productBarcode").val());
    if (productBarcode == "") {
        alertMessage($.getMessage('please_enter_the_sku'));
        $("#productBarcode").focus().select();
        return false;
    }
    var serialNumber = $.trim($("#serial").val());
    EZ.listDate.myLoading();
    var html = '';
    $("#order_no_remark").text('');
    $("#shop_name").text('');
    $("#carriers_name").text('');
    $.ajax({
        type: "post",
        async: false,
        dataType: "json",
        url: "/shipment/orders-one-pack/get-product",
        data: {
            "productBarcode": productBarcode,
            "serialNumber": serialNumber,
            "pickingCode": $.trim($("#pickingCode").val())
        },
        success: function (json) {
            if (json.state == 1) {
                //batchPackDiv
                if (json.data.batchQty > 1) {
                    $("#batchPackDiv").show();
                    $("#batchPackQty").val(json.data.batchQty).attr("qty", json.data.batchQty).attr("product_barcode", productBarcode);//.attr('packingCode', 'P000001');
                }
                // 包材代码
                var ppBarcode = json.data.ppBarcode;
                if(ppBarcode != ''){
                    $('#packingCode').val(json.data.ppBarcode);
                }

                if(!$("#fixedPackage").is(":checked") && typeof json.defaultPackage == 'string' && json.defaultPackage != '') {
                    $("#packingCode").val(json.defaultPackage);
                    $("#package_select").val(json.defaultPackage).trigger("chosen:updated");
                }
                $("#order_no_remark").text(json.orderInfo.remark);
                $("#shop_name").text(json.orderInfo.platform_shop);
                $("#carriers_name").text(json.orderInfo.carrier_name);

                html += "<tr class='table-module-b2 orderProductItem'>";
                html += '<td class="ec-center"><img width="150" height="150" class="imgPreview22" src="/default/index/view-product-img/id/'+json.data.products.product_id+' " /></td>';
                html += "<td style='font-weight:bold;font-size:18px;' class='orderProduct_" + json.data.products.product_barcode + "'>" +
                    "<a href='javascript:void(0)' " +
                    "onclick='viewProductInfo(" + json.data.products.product_id + ",\"" + json.data.products.product_barcode + "\")'>" + json.data.products.product_barcode + "</a>"
                     + (typeof json.data.products.item_ean !== 'undefined' && json.data.products.item_ean ? ('<br>EAN：' + json.data.products.item_ean) : '')                                                   
                     + "</td>";
//                    html += '<td class="ec-center" style="font-weight:bold;font-size:18px;color:#0090E1;">'+json.data.products.platform_barcode+'</td>';
                html += "<td style='font-weight:bold;font-size:18px;color: red;'>" + json.data.products.pp_barcode + "</td>";
                html += "<td style='font-weight:bold;font-size:18px;'>" + json.data.products.reference_no + "</td>";
                html += "<td style='font-weight:bold;font-size:18px;'>" + json.data.products.product_title + "</td>";
                if(isShowBoxMoreSku != undefined && isShowBoxMoreSku == '1') {
                    var isboxmoreskuHtml = '未定义';
                    if(json.data.products.is_box_more_sku == 1) {
                                isboxmoreskuHtml = '否';
                                html += "<td>" + isboxmoreskuHtml + "</td>";
                    } else if(json.data.products.is_box_more_sku == 2) {
                                isboxmoreskuHtml = '是';
                        html += "<td style='color:red;font-size:18px;'>" + isboxmoreskuHtml + "</td>";
                    } else {
                        html += "<td>" + isboxmoreskuHtml + "</td>";
                    }
                }
                html += "</tr>";
                $("#orderInfoPackName").text(json.data.packName);
                $("#table-module-list-data").html(html);
                if(IS_PACK == 1){
                    if(json.pp_barcode != '' && $("#autoPackage").is(':checked')) {
                        $('#package_select').val(json.pp_barcode).change();
                        //是否存在重复值
                        var isRepeat =   function (arr){
                                var hash = {};
                                for(var i in arr) {
                                    if(hash[arr[i]])
                                        return true;
                                    hash[arr[i]] = true;
                                }
                                return false;
                            };
                        if(isRepeat($('#package_select').val())){ //存在重复值提示
                            alertMessage('包材代码存在重复，请在下面手动重新选择!');
                            return false;
                        }
                    }
                }

                if(PRODUCT_SERIAL_INOUT > 0){
                    if($('#serial').val() != '' || has_serial == true){
                        submitPack(scan_number);
                    }else{
                        $('#serial').focus().select();
                    }
                }else{
                    submitPack(scan_number);
                }

                if($("#pickingCode", "#searchForm").val()==''){
                    isFocus(1);
                }else{
                    isFocus(2);
                }


                //跳到包材
                //isFocus(3);
            } else {
                $.each(json.error, function (key, val) {
                    html += '<span class="tip-error-message">' + val + '</span>';
                });
                if (_PACK_AUTO_AUDIO==1) {
                    autoPlayFail();
                }
                alertMessage('');
                alertTip(html)
                $("#table-module-list-data").EzWmsSetSearchData({state: 1});
                $("#productBarcode").select();
                isFocus(2);
            }
        }
    });
}













//序列号扫描
function submitSerial() {
    var orderCode = $.trim($('#orderCode').val());
    if(!orderCode){
        orderCode =  $('#pickingCode').val();
    }


    var params = {
        'pickingCode':orderCode,
        'productBarcode':$.trim($('#productBarcode').val()),
        'serial':$.trim($('#serial').val())
    };
    //增加是否扫描序列号配置
    if(canSerialNumber == '1'){
        //判断序列号是否存在
        if($("#is_serial").attr('checked') =='checked'){
            var serial = $("#serial").val();
            if(serial.length <1){
                alertTip("<span class='tip-error-message'>"+$.getMessage('操作失败：请输入序列号')+"</span>");
                return false;
            }else{
                params.is_serial = 1;//是否扫描序列号 1 是 0 否
                params.serial = serial;//序列号
            }
        }
    }else if(canSerialNumber == '2') {  //增加是否自动扫描序列号
        var serial = $("#serial").val();
        if(serial.length <1){
            alertTip("<span class='tip-error-message'>"+$.getMessage('操作失败：请输入序列号')+"</span>");
            return false;
        }else{
            params.is_serial = 2;//是否扫描序列号 1 是 0 否 2 自动检测是否扫描序列号
            params.serial = serial;//序列号
        }
    }
    var warehouseId = $.cookie('current_operation_warehouse');
    params.warehouseId = warehouseId;
    $.post('/shipment/orders-pack/submit-serial',params,function (json) {
        json = $.parseJSON(json);
        if (json.state == '1') {
            scanProduct(1);
        } else {
            if (_PACK_AUTO_AUDIO==1) {
                autoPlayFail();
            }
        }
        alertMessage(json.message);
//                isFocus(1);
    });
}


function isFocus(t) {
    switch (t.toString()) {
        case '1':
            if($("#scanPickingCode:checked").size()){
                $("#pickingCode").val('').focus().select();
                $("#productBarcode").val('');
                $("#serial").val('');
            }else{
                isFocus(2);
            }
            break;
        case '2':
            setSkuFocus();
            break;
        case '3':
            $("#packingCode").focus().select();
            break;
        case '4':
            $("#so_weight").focus().select();
            break;
        case '5':
            setSerialNumberFocus();
            break;
        case '6':
            $("#o_weight").focus().select();
            break;
        default:
            break;
    }
}

function alertLoadingTip(tip, width, height) {
    width = width ? width : 400;
    height = height ? height : 'auto';
    $('<div title="操作提示" id="dialog-loading-alert-tip"><p align="">' + tip + '</p></div>').dialog({
        autoOpen: true,
        width: width,
        height: height,
        modal: true,
        show: "slide",
        buttons: [

        ],
        close: function () {
            $(this).detach();
        }
    });
}

function alertTip3(tip, width, height) {
    width = width ? width : 400;
    height = height ? height : 500;
    $('<div title="操作提示" id="dialog-auto-alert-tip"><p align="">' + tip + '</p></div>').dialog({
        autoOpen: true,
        width: width,
        maxHeight: height,
        modal: true,
        show: "slide",
        buttons: [
            {
                text:$.getMessage("close"),
                click: function () {
                    $(this).dialog("close");
                    if($.trim($("#pickingCode").val())==''){
                        isFocus(1);
                    }else{
                        isFocus(2);
                    }
                }
            }
        ],
        close: function () {
            $(this).detach();
        }
    });
}


//产品信息
function viewProductInfo(id,sku) {
    var w = parent.windowWidth();
    var h = parent.windowHeight();
    parent.openIframeDialogForCustom("/receiving/received/view-product-info/id/"+id,w-400,h-200,sku+'：详细信息',"productDetailDialog");
}


//批量打包
function batchSubmitPack(){
    var batchPackQtyObj = $("#batchPackQty");
    var qty = parseInt(batchPackQtyObj.attr("qty"));
    var sku = $.trim(batchPackQtyObj.attr("product_barcode"));
    var packingCode = $.trim($("#packingCode").val());
    var pickingCode = $.trim($("#pickingCode").val());
    //去重
    var arr_unique =   function (str){
        var arr = str.split(',');
        var hash = {};
        var newArr = [];
        for(var i in arr) {
            if(hash[arr[i]]){
                continue;
            }
            hash[arr[i]] = arr[i];
            newArr.push(arr[i]);
        }
        return newArr.join(',');
    };
    packingCode = arr_unique(packingCode);

    var quantity = batchPackQtyObj.val();
    if (qty < parseInt(quantity)) {
        alertMessage("打包数据不能大于预期数量");
        return false;
    }
    alertLoadingTip("正在处理中,请稍等...",320);
    $.ajax({
        type: "post",
        async: true,
        dataType: "json",
        url: "/shipment/orders-one-pack/batch-submit-pack",
        data: {
            "pickingCode": pickingCode,
            "productBarcode": sku,
            "packingCode": packingCode,
            "quantity": quantity,
            "pack_log_info" : {
                "picking_code": pickingCode,
                "product_id": 0,
                "product_barcode": sku,
                "order_code": "",
                "serial_number": "",
                "pack_type": 2,
                "quantity" : quantity
            }
        },
        success: function (json) {
            $("#batchPackQty").val(json.batchQty).attr('qty', json.batchQty);
            if(json.batchQty=='0'){
                $("#batchPackDiv").hide();
                setSkuFocus();
            }
            if(json.state){
                var html='';
                html+='<table width="100%" border="0" cellspacing="0" cellpadding="0" class="table-module" style="font-size: 14px;">';
                html+='<tbody><tr class="table-module-title">';
                html+='<td class="ec-center" width=35>第</td>';
                html+='<td>订单号</td>';
                html+='<td>跟踪号</td>';
                html+='<td>运输方式</td>';
                html+='<td>产品代码</td>';
                html+='<td width="70">操作</td>';
                //是否打印标签
                var isPrintLabel = $("#isPrintLabel:checked").size();
                $.each(json.data,function(key, item){
                    if (item.state == '1') {
                        had_batch_packed = 1;
                        var scanQtyObj = $("#pickingInfoPickingScanQty");
                        var QtyObj = $("#pickingInfoPickingQty");
                        scanQtyObj.text(parseInt(scanQtyObj.text()) + 1);
                        QtyObj.text(parseInt(QtyObj.text()) - 1);
                        //记录下打包日志信息
                        // packLogInfo('',item.orderCode,item.data.products[0].product_id);
                        if (typeof json.pack_scan_log_submit == 'undefined' || !json.pack_scan_log_submit) {
                            packLogInfo('',item.orderCode,item.data.products[0].product_id);
                        }
                        html += "<tr class='table-module-b" + (key % 2 ? 1 : 2) + "'>";
                        html += "<td class='ec-center'>"+ (key+1)+"</td>";
                        html += "<td>"+ item.orderCode+"</td>";
                        html += "<td>"+ item.tracking_number+"</td>";
                        html += "<td>"+ item.data.order.sm_code+"</td>";
                        html += "<td>"+ json.productBarcode+"</td><td style='text-align:center' class='aPrintLabel'>";
                        if(item.data.is_cn_label==1){
                            html += '<span><a href=javascript:void(0);doCnRePrint("' + item.orderCode + '");>重新打印</a></span>';
                        } else if (item.data.printMode.toLowerCase() == 'pdf' || item.data.printMode.toLowerCase() == 'pdf2png') {
                            html += '<span><a target="_blank" href="/default/system/down-label/code/' + item.orderCode + '";>下载PDF</a>&nbsp;&nbsp;<a href=javascript:void(0);getOrdersReprint("' + item.orderCode + '");>重新打印</a></span>';
                            html += '&nbsp;&nbsp;<a href=javascript:void(0);label_obtain("'+ item.orderCode+'");>重新获取标签</a>';
                        } else {
                            html += '<span><a href=javascript:void(0);getOrdersReprint("' + item.orderCode + '");>重新打印</a></span>';
                            html += '&nbsp;&nbsp;<a href=javascript:void(0);label_obtain("'+ item.orderCode+'");>重新获取标签</a>';
                        }
                        html+="</td></tr>";

                        if (item.isFocus == '1') {
                            $("#pickingInfo").hide();
                            $("#searchForm").resetForm();
                            alertMessage('下架单：'+pickingCode+'已全部完成.');
                            isFocus(1);
                        }
                        setSkuFocus();
                        isFocus(item.isFocus);
                        alertMessage('');
                        if(isPrintLabel) {
                            if(item.data.is_cn_label==1){
                                var labelData = item.data.cn_label;
                                caiPrint.doCnPrint(labelData);
                            }else {
                                var isPdfPrinter = $("#isPdfPrinter:checked").size();
                                item.data.CPdfPrinter = isPdfPrinter;
                                shipPrint(item.data, item.data.order.sm_code,'',item.data.is_print_invoice_label);
                            }
                        }
                        if(item.print_invoice=='1'){
                            printUrlForPrinter(item.print_url,'746','100%','10','12',"invoice");
                        }
                        setTimeout(function(){
                            isFocus(item.isFocus);
                            if(item.isFocus=='2'){
                                setSkuFocus();
                            }
                        }, 700);
                    } else {
                        $.each(item.error, function (ek, ev) {
                            html += '<tr><td colspan="5"><span class="tip-error-message">' + ev + '</span></td></tr>';
                        });
                    }
                });
                html+=' </tbody></table>';
                $("#dialog-loading-alert-tip").dialog("close");
                alertMessage(html,760);
            }else{
                var html = '';
                if(json.message != '') {
                    html += '<span class="tip-error-message">' + json.message + '</span>';
                } else if(typeof json.data != 'undefined' && json.data != null) {
                    $.each(json.data,function(key, item){
                        $.each(item.error,function(ek, ev){
                            html += '<span class="tip-error-message">' + ev + '</span>';
                        });
                    });
                } else {
                    html += '<span class="tip-error-message">unknown error</span>';
                }
                $("#dialog-loading-alert-tip").dialog("close");
                alertMessage(html);
            }
            var pickingCodeObj = $("#pickingCode");
            if (pickingCodeObj.val() == '') {
                pickingCodeObj.focus();
            }
        }
    });
}

function setSkuFocus(){
    $("#productBarcode").focus().select();
}


function setSerialNumberFocus(){
    $("#serial").focus().select();
}


function submitPack(scan_number) {
    has_serial = false;
    alertMessage('');
    var pickingCode = $.trim($("#pickingCode", "#searchForm").val());
    var productBarcode = $.trim($("#productBarcode", "#searchForm").val());

    //打印日志记录
    // var print_tracking_no = recordPrintingLog('', 'begin');
    var print_tracking_no = '';
    //扫描的产品外箱信息
    var product_outer_info = { };
    $(".outer_info").each(function(k,obj){
        var outer_name = $(this).attr("name");
        var outer_value = $(this).val();

        product_outer_info[outer_name] = outer_value;
    });
    var serial_number = $('#serial').val();
    $.ajax({
        type: "post",
        async: false,
        beforeSend:function(){
            var pickingCode = $.trim($("#pickingCode", "#searchForm").val());
            var packCode = $.trim($('#packingCode').val());
            var productBarcode = $.trim($('#productBarcode').val());
            //查询是否勾选 ‘启用’ 拣货单号checkbox  => yss修复 ID：1032452
            var scanPickingCode = $("#scanPickingCode:checked").size();
            if(scanPickingCode > 0){
                if(pickingCode == ''){
                    if (_PACK_AUTO_AUDIO==1) {
                        autoPlayFail();
                    }
                    alertMessage($.getMessage('please_enter_picking_single'));
                    $('#pickingCode').focus().select();
                    return false;
                }
            }
            if(productBarcode == ''){
                if (_PACK_AUTO_AUDIO==1) {
                    autoPlayFail();
                }
                alertMessage($.getMessage('please_enter_the_sku'));
                $('#productBarcode').focus().select();
                return false;
            }
            if(packCode == ''){
                if (_PACK_AUTO_AUDIO==1) {
                    autoPlayFail();
                }
                alertMessage($.getMessage('please_enter_the_code_packaging_materials'));
                $('#packingCode').focus().select();
                return false;
            }

        },
        dataType: "json",
        url: "/shipment/orders-one-pack/submit-pack",
        data: {
            "pickingCode": pickingCode,
            "productBarcode": productBarcode,
            "packingCode": $("#packingCode", "#searchForm").val(),
            "scan_number": scan_number,
            "tracking_no": print_tracking_no,
            "product_outer_info" : product_outer_info,
            "pack_log_info" : {
                "picking_code": pickingCode,
                "product_id": 0,
                "product_barcode": productBarcode,
                "order_code": "",
                "serial_number": serial_number,
                "pack_type": 2,
                "quantity" : scan_number
            }
            ,"record_printing_log" : { "tag":"begin", "tracking_no":pickingCode + ":" + productBarcode, "refer_url":window.location.href }
        },
        success: function (json) {
            //不管打包成功或失败都清空产品外箱信息
            $("#product_outer_info").empty();

            var html = '';
            if (isJson(json)) {
                if (json.state == '1') {
                    if (typeof json.print_tracking_no != 'undefined' && json.print_tracking_no) {
                        print_tracking_no = json.print_tracking_no;
                    }
                    //批量减少一个
                    try{
                        if(typeof $("#batchPackQty") != 'undefined') {
                            var old_product_barcode = $("#batchPackQty").attr('product_barcode');
                            if(old_product_barcode == productBarcode) {
                                var old_qty = $("#batchPackQty").val();
                                var new_qty = old_qty - 1;
                                if(new_qty <= 1) {
                                    $("#batchPackDiv").hide();
                                } else {
                                    $("#batchPackQty").val(new_qty).attr("qty", new_qty);
                                }
                            }
                        }
                    } catch (error) { }

                    //记录下打包日志信息
                    // var serial_number = $('#serial').val();
                    // packLogInfo(serial_number,json.orderCode,json.data.products[0].product_id)
                    if (typeof json.pack_scan_log_submit == 'undefined' || !json.pack_scan_log_submit) {
                        packLogInfo(serial_number,json.orderCode,json.data.products[0].product_id)
                    }
                    $("#pickingInfo").show();
                    $("#pickingInfoPickingScanQty").text(json.finish);
                    $("#pickingInfoPickingQty").text(json.scanQty);
                    $("#freebies_packing").html(json.freebies_packing);
                    if(json.data.is_cn_label==1){
                        html += '<span><a href=javascript:void(0);doCnReprint("' + json.orderCode + '");>重新打印</a></span>';
                    } else if (json.data.printMode.toLowerCase() == 'pdf' || json.data.printMode.toLowerCase() == 'pdf2png') {
                        html += '<span>SKU:[' + productBarcode + ']&nbsp;&nbsp;' + json.orderCode + '&nbsp;&nbsp;' + json.message + '&nbsp;&nbsp;<a target="_blank" href="/default/system/down-label/code/' + json.orderCode + '";>下载PDF</a>&nbsp;&nbsp;<a href=javascript:void(0);getOrdersReprint("' + json.orderCode + '");>重新打印</a></span>';

                        html += '&nbsp;&nbsp;<a href=javascript:void(0); label_obtain("'+ json.orderCode+'");>重新获取标签</a>';
                    } else {
                        html += '<span>SKU:[' + productBarcode + ']&nbsp;&nbsp;' + json.orderCode + '&nbsp;&nbsp;' + json.message + '&nbsp;&nbsp;<a href=javascript:void(0);getOrdersReprint("' + json.orderCode + '");>重新打印</a></span>';

                        html += '&nbsp;&nbsp;<a href=javascript:void(0);label_obtain("'+ json.orderCode+'");>重新获取标签</a>';
                    }
                    //自动签出
                    if(json.autoDelivery=='1'){
                        alertMessageDelivery(json.autoDeliveryResult.message,json.autoDeliveryResult.state);
                    }
                    if (json.isFocus == '1') {
                        //$("#pickingInfo").hide();
                        var scanPickingCode = $("#scanPickingCode:checked").size();
                        //$("#searchForm").resetForm();
                        alertMessage($.getMessage('PutawayCode_x_has_been_completed', [pickingCode]));//'拣货单：'+pickingCode+'已全部完成.'
                        if (scanPickingCode) {
                            isFocus(1);
                        } else {
                            $("#scanPickingCode").attr("checked", false);
                            isFocus(2);
                        }
                    }
                    setSkuFocus();
                    isFocus(json.isFocus);
                    alertMessage(html);
                    //是否打印标签
                    var isPrintLabel = $("#isPrintLabel:checked").size();
                    var isPdfPrinter = $("#isPdfPrinter:checked").size();
                    if(isPrintLabel) {
                        if(json.data.is_cn_label==1){
                            var labelData = json.data.cn_label;
                            caiPrint.doCnPrint(labelData);


                            recordPrintingLog(print_tracking_no, 'end');
                        }else{
                            json.data.CPdfPrinter = isPdfPrinter;
                            shipPrint(json.data, json.data.order.sc_code,'',json.data.is_print_invoice_label);
                        }
                    }
                    if(json.print_invoice=='1'){
                        printUrlForPrinter(json.print_url,'746','100%','10','12',"invoice");
                    }


                    //是否打印出库清单
                    var PrintLibraryList = $("input[name='PrintOutTheLibraryList']:checked").val();
                    if(PrintLibraryList ==1) {
                        printLibraryList(json.orderCode,print_tracking_no);
                    }

                    //是否打印物料单
                    var PrintBillOfMaterialsList = $("input[name='PrintBillOfMaterialsList']:checked").val();
                        if(PrintBillOfMaterialsList ==1) {
                        printBillOfMaterialsList(json.orderCode,print_tracking_no);
                    }

                    // 其他附件
                    var PrintOtherDocumentsAttach = $("input[name='PrintOtherDocumentsAttach']:checked").val();
                    if(PrintOtherDocumentsAttach == 1) {
                        printOtherDocumentsAttach(json.orderCode);
                    }

                    //发送日本佐川标签文件
                    if(json.apiCode =='ZUOCHUAN') {
                        if (getCPDFPrinterStatus() && typeof (pdfPrinter) === "object") {
                            SendJapanLaberFile(json.orderCode);
                        }else{
                            SendJapanLaberFile(json.orderCode,1);
                        }
                    }


                    //支持称重签出
                    $("#weighting_ship_div").hide();
                    $("#weighting_ship_new_div").hide();
                    if(json.ship_info.is_pack_and_weight == '1'){
                        operation_warehouse = json.data.order.warehouse_id;

                        if(json.ship_info.warehouse_weight_unit){
                             $(".warehouse_weight_unit").html(json.ship_info.warehouse_weight_unit);
                        }
                         if(json.ship_info.warehouse_size_unit){
                             $(".warehouse_size_unit").html(json.ship_info.warehouse_size_unit);
                        }
                         is_pack_and_weight  = json.ship_info.is_pack_and_weight;

                         $("#ship_order_code_new").val(json.data.order.order_code);
                         $("#ship_sm_code_new").val(json.data.order.sc_code);
                         $("#ship_tracking_number_new").val(json.data.order.tracking_number);
                         $("#weighting_ship_new_div").show();
                         $("#o_weight").select();
                         isFocus(6);

                          if(is_pack_and_weight){
                            var scCode = json.data.order.sc_code;
                            var smCode = json.data.order.sm_code;
                            if(scCode){
                                vailServiceChannel(scCode,smCode);
                            }
                            scanOrderInfo();
                            if(json.data.order.pm_weighting_ship != '1'){
                                //WMS端-【出货管理】-【打包管理】-【集中分拣】整个拣货单完成，“中文环境”则语音提示-中文：“配货完成”、“英文环境”则语音提示-英文
                                if(json.order_pick_sound == 1){
                                    autoPlayDistributionCompleted();
                                }
                                return;
                            }
                        }
                    }

                    if (json.data.pm_weighting_ship == '1') {
                        $("#ship_sm_code").val(json.data.order.sc_code);
                        $("#ship_tracking_number").val(json.data.order.tracking_number);
                        $("#ship_order_code").val(json.orderCode);
                        $("#is_focus_code").val(json.isFocus);
                        $("#weighting_ship_div").show();

                        setTimeout(function () {
                            $("#so_weight").select();
                            isFocus(4);
                        }, 700);

                        //自动加载电子称读数
                        if (!!window.ActiveXObject || "ActiveXObject" in window){
                            setInterval(function () {
                                if ($('#ship_order_code').val().length > 0 && $('#ship_order_code').val() != '') {
                                    var weight = EletronicToolsActive.GetWeight();
                                    if (weight > 0) {
                                        $("#o_weight").val(weight);
                                    }
                                }
                            }, 1000);
                        }
                        //WMS端-【出货管理】-【打包管理】-【集中分拣】整个拣货单完成，“中文环境”则语音提示-中文：“配货完成”、“英文环境”则语音提示-英文
                        if(json.order_pick_sound == 1){
                            autoPlayDistributionCompleted();
                        }
                        return;
                    } else {
                        var sleep = 700;
                        sleep = json.data.printMode.toLowerCase() == 'pdf' ? 1200 : sleep;
                        setTimeout(function () {
                            isFocus(json.isFocus);
                            if (json.isFocus == '2') {
                                setSkuFocus();
                            }
                        }, sleep);
                    }
                    //WMS端-【出货管理】-【打包管理】-【集中分拣】整个拣货单完成，“中文环境”则语音提示-中文：“配货完成”、“英文环境”则语音提示-英文
                    if(json.order_pick_sound == 1){
                        autoPlayDistributionCompleted();
                    }else if (_PACK_AUTO_AUDIO==1) {
                        autoPlaySuccess();
                    }

                    if(setSerial == 1){
                       $('#serial').val('');
                    }

                    return ;
                } else {
                    if (_PACK_AUTO_AUDIO==1) {
                        autoPlayFail();
                    }
                    var error = json.error;
                    if(error['is_intercept'] == '1'){
                        error['is_intercept'] = '';
                        $.ajax({
                            type: "post",
                            dataType: "json",
                            url: "/shipment/orders-one-pack/print-intercept",
                            data: {
                                "pickingCode": pickingCode,
                                "productBarcode": productBarcode,
                            },
                            success: function(json) {
                                var isPdfPrinter = $("#isPdfPrinter:checked").size();
                                if(!$.isEmptyObject(json.data)){
                                    $.each(json.data,function (k,v) {
                                        v.CPdfPrinter = isPdfPrinter;
                                        shipPrint(v, v.order.sc_code);
                                    });
                                }
                            }
                        });
                    }
                    $.each(error, function (key, val) {
                        html += '<span class="tip-error-message">' + val + '</span>';
                    });
                }

                alertMessage(html);
                setTimeout(function(){
                    isFocus(json.isFocus);
                    if(json.isFocus=='2'){
                        setSkuFocus();
                    }
                }, 700);
                return;
            } else {
                alertTip('<span>后端返回数据格式错误，请联系IT</span>');
                $.ajax({
                    type: "post",
                    dataType: "html",
                    url: "/shipment/orders-one-pack/submit-pack?debug=true",
                    data: {
                        "pickingCode": pickingCode,
                        "productBarcode": productBarcode,
                        "packingCode": $("#packingCode", "#searchForm").val()
                    },
                    success: function (json) {
                        alertTip('<p>后端返回数据格式异常，请复制以下报错信息发给IT</p>' + json);
                    }
                });
            }

        }
    });
}

function forceComplete() {
    alertMessage('');
    var html = '';
    var pickingCode = $.trim($("#pickingCode").val());
    if (pickingCode == "") {
        alertMessage($.getMessage('please_enter_picking_single'));
        isFocus(1);
        $("#pickingInfo").hide();
        return false;
    }
    html = '<span class="tip-warning-message">是否确认强制完成此拣货单?</span>';
    alertTip(html);
    $('#dialog-auto-alert-tip').dialog('option',
            'buttons',
            {
                [$.getMessage("confirm")]: function () {
                    confirmPickOrders();
                    $(this).dialog("close");
                }, [$.getMessage("cancel")]: function () {
                isFocus(2);
                $(this).dialog("close");
            }
    });
}

function confirmPickOrders() {
    var html = '';
    var pickingCode = $.trim($("#pickingCode").val());
    if (pickingCode == "") {
        alertMessage($.getMessage('please_enter_picking_single'));
        $("#pickingInfo").hide();
            isFocus(1);
        return false;
    }
    $.ajax({
        type: "post",
        async: false,
        dataType: "json",
        url: "/shipment/orders-one-pack/confirm-pick-orders",
        data: {
            "pickingCode": $("#pickingCode", "#searchForm").val()
        },
        success: function (json) {
            html='';
            if (isJson(json)) {
                if (json.state == '1') {
                    html += '<span class="tip-success-message">操作成功:由于部分订单未完成,需要重新打印。</span>';
                    html += '<span class="tip-success-message">拣货单号<!--拣货单号-->：'+json.pickingCode+'&nbsp;&nbsp;<a style="color:#0090e1;text-decoration:underline;" target="_blank" href=/shipment/picking/print-picking/pickType/one?pickCodes[]='+json.pickingCode+'>打印单据<!--打印单据--></a></span>';
                    html += '<span class="tip-success-message">订单总数<!--订单总数-->：'+json.orderCnt+'</span>';
                    $("#pickingInfo").hide();
                    $("#searchForm").resetForm();
                    alertTip(html);
                  //  window.open("/shipment/picking/print-picking/pickType/one?pickCodes[]=" + json.pickingCode);
                } else {
                    $.each(json.error, function (key, val) {
                        html += '<span class="tip-error-message">' + val + '</span>';
                    });
                    alertMessage(html);
                }
                $('#dialog-auto-alert-tip').bind('dialogclose', function (event, ui) {
                    isFocus(1);
                });
                return;
            }
            alertTip('<span>error</span>');
        }
    });
}

function getPackOrdersLog(){
    var pickingCode = $.trim($("#pickingCode").val());
    var html='';
    $.ajax({
        type: "post",
        async: true,
        dataType: "json",
        url: "/shipment/orders-one-pack/get-print-orders-log",
        data: {pickingCode: pickingCode},
        success: function (json) {
            var html = '';
            if (isJson(json)) {
                if (json.state == '1') {
                    html+="<div style='font-size:14px;font-weight:bold;height:30px;line-height:30px;'>操作提示：仅显示今日一票一件(按SKU打包)的订单记录;</div>";
                    html+='<table width="100%" border="0" cellspacing="0" cellpadding="0" class="table-module getPackOrdersLog">';
                    html+='<tbody><tr class="table-module-title">';
                    html+='<td class="ec-center" width="35">否</td>';
                    html+='<td class="ec-center" width="50">篮子号</td>';
                    html+='<td width="200">订单信息</td>';
                    html+='<td width="200">配货信息</td>';
                    html+='<td>运输方式</td>';
                    html+='<td>扫描时间</td>';
                    html+='<td width="95">操作</td>';
                    var btnTitle='标记问题件';
                    var exceptionType='';
                    $.each(json.data, function (key, val) {
                        html += (key + 1) % 2 == 1 ? "<tr class='table-module-b1'>" : "<tr class='table-module-b2'>";
                        if (val.order_exception_type == '0') {
                            btnTitle = '标记问题件';
                            exceptionType='';
                        }else{
                            btnTitle = '编辑问题类型';
                            if(locale_message_language=='zh_CN'){
                                exceptionType = "<br>异常：<span class='orderExceptionSubType'>" + (orderExceptionSubTypeJson[val.order_exception_sub_type] ? orderExceptionSubTypeJson[val.order_exception_sub_type].oest_name : '')+'</span>';
                            }else{
                                exceptionType = "<br>异常：<span class='orderExceptionSubType'>" + (orderExceptionSubTypeJson[val.order_exception_sub_type] ? orderExceptionSubTypeJson[val.order_exception_sub_type].oest_name_en : '')+'</span>';
                            }
                        }
                        html += "<td class='ec-center'>"+ (key+1)+"</td>";
                        html += "<td class='ec-center'>"+ val.picking_basket+"</td>";
                        html += "<td class='orderProductItem'>" + EZ.orderCode + "：<a href=\"javascript:void(0)\" " +
                        "onclick='leftMenu(\"" + val.order_code + "\",\"订单号:" + val.order_code + "\",\"/order/orders/view/order_code/" + val.order_code + "\")'>" + val.order_code + "</a><br>跟踪号："+val.tracking_number+exceptionType+"</td>";
                        html += "<td>配货单号："+ val.pick.picking_code+"<br>产品代码："+val.pick.product_barcode+"</td>";
                        html += "<td>"+ val.sc_code+"<br>"+val.sc_name+"</td>";
                        html += "<td>"+ val.pack_time+"</td>";
                        html += "<td class='aPrintLabel'><a href=javascript:void(0);getOrdersReprint(\'"+val.order_code+"\');>打印标签</a>";
                        html += "<br><a href=javascript:void(0);editExceptionType(\'"+val.order_code+"\');>"+btnTitle+"</a>";
                        if (val.order_exception_type != '0') {
                            html += "<br><a href=javascript:void(0);printByCode(\'"+val.order_code+"\');>打印异常处理</a>";
                        }

                        html += "<br><a href=javascript:void(0);label_obtain(\'"+ val.order_code+"\');>重新获取标签</a>";
                        html += "</td></tr>";
                    });
                    html+=' </tbody></table>';
                } else {
                    html='暂无打印记录;';
                }
                alertTip3(html,960);
                return;
            }
            alertTip('<span>500 error</span>');
        }
    });
}

function reloadData(param){
    $('#dialog-auto-alert-tip').dialog("close");
    getPackOrdersLog();
}



function alertMessageDelivery(thtml,state) {
    var obj = $("#autoDelivery-message");
    if (thtml == '') {
        obj.parent().hide();
        obj.html('');
    }else{
        obj.parent().show();
        thtml=state=='1'?"<span class='delivery-success'>"+thtml+"</span>":"<span class='delivery-fail'>"+thtml+"</span>";
        obj.html(thtml);
    }
}

//重新打印
function getOrdersReprint(code) {
    $.ajax({
        type: "post",
        async: false,
        dataType: "json",
        url: "/shipment/orders-one-pack/get-order-info",
        data:{
            orderCode:code
        },
        success: function (json) {
            var html = '';
            if($("#pickingCode", "#searchForm").val()==''){
                isFocus(1);
            }else{
                isFocus(2);
            }
            if (isJson(json)) {
                if(json.state=='1'){
                    var isPdfPrinter = $("#isPdfPrinter:checked").size();
                    json.data.CPdfPrinter = isPdfPrinter;
                    shipPrint(json.data,json.data.order.sc_code,'',json.data.is_print_invoice_label);
                    if(json.print_invoice=='1'){
                        printUrlForPrinter(json.print_url,'746','100%','10','12',"invoice");
                    }

                    // 其他附件
                    var PrintOtherDocumentsAttach = $("input[name='PrintOtherDocumentsAttach']:checked").val();
                    if(PrintOtherDocumentsAttach == 1) {
                        printOtherDocumentsAttach(code);
                    }

                }else{
                    alertTip(json.message);
                }
            }
        }});
}

//菜鸟重打印
function doCnReprint(orderCode){
    $.ajax({
        type: "post",
        async: false,
        dataType: "json",
        url: "/shipment/orders-one-pack/do-cn-reprint",
        data:{
            orderCode:orderCode
        },
        success: function (json) {
            if(json.state==1 && json.data.is_cn_label){
                var cnLabel = json.data.cn_label;
                caiPrint.doCnPrint(cnLabel);//菜鸟云打印
            }
        }
    });
}

//未配SKU
function waitingData(){
    var pickingCode= $.trim($("#pickingCode").val());
    if(pickingCode==''){
        html = '<tr><td class="ec-center" colspan="5" style="color:red">No data</td></tr>';
        $("#waiting-list-data").html(html);
        $('#waitingDataDialog').dialog("open");
        return;
    }
    $.ajax({
        type: "post",
        async: false,
        dataType: "json",
        url: "/shipment/orders-pack/get-waiting-sku",
        data: {
            "pickingCode": pickingCode
        },
        success: function (json) {
            var html = '';
            if (isJson(json)) {
                if (json.state == '1') {
                    //订单产品
                    $.each(json.data, function (key, val) {
                        html += (key + 1) % 2 == 1 ? "<tr class='table-module-b1'>" : "<tr class='table-module-b2'>";
                        html += "<td class='ec-center'>" + (key + 1) + "</td>";
                        //html += '<td class="ec-center"><img width="60" height="60" class="imgPreview22" src="/default/print/view-product-img/id/' + val.product_id + '?img.jpg\" /></td>';
                        html += '<td class="ec-center"><a class="dialog-a" href="javascript:void(0);viewProductInfo('+val.product_id+',\''+val.product_barcode+'\');">';
                        html += '<img width="60" height="60" class="imgPreview22" src="/default/index/view-product-img/id/'+val.product_id+' " /></a></td>';
                        html += "<td class=''><span class='waitingDataSkuCss'>" + val.product_barcode + "</span><br>" + val.product_title
                            + (typeof val.item_ean !== 'undefined' && val.item_ean ? ("<br>EAN：" + val.item_ean) : '');
                            + "</td>";
                        html += "<td class='ec-center'>" + val.reference_no + "</td>";
                        html += "<td class='ec-center waitingDataQtyCss'>" + val.waiting_qty + "</td>";
                        html += "</tr>";
                    });
                } else {
                    html = '<tr><td colspan="4">'+json.message+'</td></tr>';
                }
                $("#waiting-list-data").html(html);
            }
        }
    });
    $('#waitingDataDialog').dialog("open");
}

//已配SKU
function hadScanData(){
    var pickingCode= $.trim($("#pickingInfoPickingCode").text());
    if(pickingCode==''){
        alertTip("下架单不能为空");
        return;
    }
    $.ajax({
        type: "post",
        async: false,
        dataType: "json",
        url: "/shipment/orders-pack/get-pack-scan-log",
        data: {
            "picking_code": pickingCode,
            "pack_type":2
        },
        success: function (json) {
            var html = '';
            if (isJson(json)) {
                if (json.state == '1') {
                    //订单产品
                     $.each(json.data,function(k,v){
                           html += (k + 1) % 2 == 1 ? "<tr class='table-module-b1'>" : "<tr class='table-module-b2'>";
                           html += "<td class='ec-center'>"+(k+1)+"</td>";
                           html += "<td class='ec-center'>" + v.product_barcode
                                + (typeof v.item_ean !== 'undefined' && v.item_ean ? ('<br>EAN：' + v.item_ean) : '')
                                + "</td>";
                           html += "<td class='ec-center'>" + v.order_code + "</td>";
                           if(v.serial_number){
                               html += "<td class='ec-center'>" + v.serial_number + "</td>";
                           }else{
                               html += "<td class='ec-center'> --- </td>";
                           }
                           html += "<td class='ec-center'>" + v.num + "</td>";
                           html += '</tr>';
                       })
                   }else{
                       html = '<tr><td class="ec-center" colspan="5" style="color:red">No data</td></tr>';
                   }
                   $('#had-scan-list-data').html( html );
            }
        }
    });
    $('#hadScanDataDialog').dialog("open");
}



function packLogInfo(serial_number='',order_code,product_id = ''){
    $.ajax({
        type: "post",
        async: false,
        dataType: "json",
        url: "/shipment/orders-pack/pack-scan-log-submit",
        data: {
            "picking_code": $.trim($("#pickingCode").val()),
            "product_id":product_id,
            "product_barcode":$.trim($('#productBarcode').val()),
            "order_code":order_code,
            "serial_number":serial_number,
            "pack_type":2
        },
        success: function (json) {

        }
    });
}

//提示声音
function autoPlay(){
    $("#autoplay").attr("src","/wav/51962.wav");
}
//提示声音：(失败)
function autoPlayFail(){
    $("#autoplay").attr("src","/wav/fail.wav");
}
//提示声音：（成功）
function autoPlaySuccess(){
    $("#autoplay").attr("src","/wav/success.wav");
}

//WMS端-【出货管理】-【打包管理】-【集中分拣】整个拣货单完成，“中文环境”则语音提示-中文：“配货完成”、“英文环境”则语音提示-英文
function autoPlayDistributionCompleted(){
    if(locale_language == 'zh_CN'){
    $("#autoplay").attr("src","/wav/pack/distribution_completed_zh.mp3");
}else{
    $("#autoplay").attr("src","/wav/pack/distribution_completed.mp3");
}
}



//重新获取标签
function label_obtain(code){
    var codeArr = [];
    codeArr.push(code);

    $.ajax({
        type : 'post',
        url  : '/label/label-management/batch-get-label/',
        async: false,
        data : { 'codes':codeArr, 'order_type':'order' },
        dataType : 'json',
        success  : function(json){
            alertTip(json.message);
        }
    });
}



//功能设置
function function_settings(){
    $("#function_settings_dialog").dialog("open");
}


    function unitSwitch(obj,value,warehouse_id,attr,unit_type,type){
        if(type == '1'){
            if(unit_type == '1'){
                //尺寸
                $('.'+attr).val(util.getWarehouseSizeValue(value,warehouse_id)).trigger('change');
            }else{
                //重量
                $('.'+attr).val(util.getWarehouseWeightValue(value,warehouse_id)).trigger('change');
            }
        }else{
            //仓库
            if(unit_type == '1'){
                $('.'+attr).val(util.getSystemSizeValue(value,warehouse_id)).trigger('change');
            }else{
                $('.'+attr).val(util.getSystemWeightValue(value,warehouse_id)).trigger('change');
            }
        }
    }


    function vailServiceChannel(scCode,smCode){
        var uri = '/shipment/orders/scan-service-channel';
        $.post(uri, {scCode: scCode,smCode:smCode}, function (json) {
            if (!isJson(json)) {
                alertTip('error 500');
            }
            if (json.state == '0') {
                $('#message_tip').text(json.message).show();
            }
            else {
               // $("#isVolume").val(json.isVolume);
            //    $('#message_tip').text('').hide();


            }
            //订单签出自主测量体积重配置开关
            $(".measure_system").hide();
            $(".measure_warehouse").hide();
            if(json.is_oneself_vol_weight==1){
                if (json.vol_type != undefined && json.vol_type != '') {
                    volType = json.vol_type;
                }
                if (isPerimeter()) {
                    $('.symbol-change').text('+');
                } else {
                    $('.symbol-change').text('*');
                }

                if(warehouseUnitEnable==1){
                    $(".measure_warehouse").show();
                }else if(warehouseUnitEnable==2){
                    $(".measure_system").show();
                    $(".measure_warehouse").show();
                }else{
                    $(".measure_system").show();
                }

                $("input[name='vol_rate']").val(json.vol_rate).attr("disabled",false);
                $("input[name='parcel_vol_weight']").attr("disabled",false);
                $("input[name='parcel_vol_warehouse_weight']").attr("disabled",false);
            }else{
                $(".measure_system").hide();
                $(".measure_warehouse").hide();
                $("input[name='vol_rate']").attr("disabled",true);
                $("input[name='parcel_vol_weight']").attr("disabled",true);
                $("input[name='parcel_vol_warehouse_weight']").attr("disabled",true);
            }
        }, 'json');
    }

    function isPerimeter() {
        if (volType == 5 || volType == 6) {
            return true;
        } else {
            return false;
        }
    }


    function delivery() {
        if(had_batch_packed == 1){
             alertTip('已操作批量打包，不支持批量称重签出，请到订单签出页面操作');
             return false;
        }
        if ($("#ship_sm_code_new").val() == '') {
            alertMessage('请扫描渠道代码');
            autoPlayFail();
            return;
        }
        if ($("#ship_sm_code_new").val() == '') {
            alertMessage('请输入订单号');
            autoPlayFail();
            return;
        }

        if ($("#o_weight").val() == '') {
            alertMessage('请输入订单重量');
            $('#o_weight').val('').focus();
            autoPlayFail();
            return;
        }

            var uri = '/shipment/orders/scan-delivery';
            var orderCode = $("#ship_order_code_new").val();
            var is_force = $("#is_force_new").val();
            var ship_sm_code = $("#ship_sm_code_new").val();
            var tracking_number = $("#ship_tracking_number_new").val();
            var so_weight = $("#o_weight").val();
            var parcel_length =$("input[name='parcel_length']").val();
            var parcel_width = $("input[name='parcel_width']").val();
            var parcel_height = $("input[name='parcel_height']").val();
            var parcel_vol_weight = $("input[name='parcel_vol_weight']").val();

            var params = $.param({
                'sc_code' : ship_sm_code,
                'order_code':orderCode,
                'ship_code':tracking_number,
                'o_weight':so_weight,
                'parcel_length':parcel_length,
                'parcel_width' :parcel_width,
                'parcel_height':parcel_height,
                'parcel_vol_weight':parcel_vol_weight,
                'is_pack_and_weight':1
            });

            $.post(uri,params, function(data){
            if (!isJson(data)) {
    //            $('#is_force').val(0);
                alertMessage('Internal error:Json; ship order');
                return;
            }
            if (data.state == '1') {
                had_operate_ship_order = 1;
                $(".parcel_measure").val('');//清空测量体积重各input数据
                $("#parcel_vol_weight").html(0);//清空测量体积重数据
                $("#parcel_vol_weight_input").val(0);//清空测量体积重隐藏域数据

                $("#parcel_vol_warehouse_weight").html(0);//清空测量体积重数据
                $("#parcel_vol_weight_warehouse_input").val(0);//清空测量体积重隐藏域数据
                alertMessage('出货成功');
                $('#is_force_new').val(0);
                isFocus(2);
    //            $('#orderCode').focus();
                $('#o_weight').val('');
                $('#warehouse_weight').val('');
                $("#ship_order_code_new").val('');
                $("#is_force_new").val('');
                $("#ship_sm_code_new").val('');
                $("#ship_tracking_number_new").val('');
                $("#weighting_ship_new_div").hide();
                autoPlaySuccess();
            } else if (data.state == '2') {
                var message = data.message + ',您确定要出货吗？';
                $('<div title="操作提示" class="dialog-confirm-del-alert-tip"><p style="color:red;">' + message + '</p></div>').dialog({
                    autoOpen: true,
                    width: '320',
                    height: 'auto',
                    modal: true,
                    show: 'slide',
                    buttons: {
                        '确认': function () {
                            $('#is_force').val(1);
                            delivery();
                            $(this).dialog('close');
                        },
                        '取消': function () {
                            $('#o_weight').focus();
                            $(this).dialog('close');
                        }
                    }
                });
            } else {
                autoPlayFail();
                $('#is_force_new').val(0);
                var mess = data.message;
                alertMessage(mess);
            }
        },'json');
    }


    function scanOrderInfo(){
        $.post('/shipment/orders/scan-order-info', {
            sc_code: $("#ship_sm_code_new").val(),
            order_code: $.trim($("#ship_order_code_new").val()),
            scanProduct: 1,
            isAutoChannel:0,
            deliveryScan:0,
            current_operation_warehouse:operation_warehouse
        }, function (data) {
            if (data.state === 0){
                alertMessage(data.message);
            }
            else {
                var html='';
                var dHtml='';

                //是否需要复合产品
                var scan_ask=false;
                var autoDelivery = false;

                //填充长宽高
                $("#parcel_length_input").val(data.detail.product_length);
                $("#parcel_width_input").val(data.detail.product_width);
                $("#parcel_height_input").val(data.detail.product_height);
                $("#parcel_length_input_wa").val(data.detail.product_length_wa);
                $("#parcel_width_input_wa").val(data.detail.product_width_wa);
                $("#parcel_height_input_wa").val(data.detail.product_height_wa);

                //系统单位
                $("#parcel_vol_weight").html(data.detail.parcel_vol_weight);
                $("#parcel_vol_weight_input").val(data.detail.parcel_vol_weight);
                //仓库单位
                $("#parcel_vol_warehouse_weight").html(data.detail.parcel_vol_weight_wa);
                $("#parcel_vol_warehouse_weight_input").val(data.detail.parcel_vol_weight_wa);

                //体积系数
                if(data.detail.vol_rate!=''){
                    $("input[name='vol_rate']").val(data.detail.vol_rate);
                }
                //配货信息
                if(warehouseUnitEnable == '1' || warehouseUnitEnable == '2'){
                    $("#estimate_weight").text(util.getWarehouseWeightValue(data.detail.estimateWeight,operation_warehouse));
                }else{
                    $("#estimate_weight").text(data.detail.estimateWeight);
                }

                $("#isWeighing").val(data.detail.weighing);

                var totalWeight='';
                var weightObj=$('#o_weight');

                $("#order_code").val(data.detail.order_code);



                //填充订单产品重
                totalWeight = data.detail.totalWeight;
                if (weightObj.val() == '') {
                    weightObj.val(totalWeight);
                }
                weightObj.trigger('keyup');

                if (warehouseUnitEnable == '1') {
                    weightObj = $('#warehouse_weight');
                }

                if (data.detail.isTracking == '0') {
                    weightObj.focus().select();
                    //直接签出
                    if (!scan_ask && data.detail.weighing == '2') {
                        autoDelivery = true;
                    }
                }else if(data.detail.tracking_number != ''){
                    if(data.detail.tracking_number.toUpperCase()==data.detail.order_code.toUpperCase()){
                        weightObj.focus().select();
                    }else{
                        weightObj.focus().select();
                        //直接签出
                        if (!scan_ask && data.detail.weighing == '2') {
                            autoDelivery=true;
                        }
                    }
                } else {

                }
                //签出
                if(autoDelivery){
                    delivery();
                }
            }


        }, 'json');

        return false;
    }


    //打印出库清单
    function printLibraryList(orderCode,print_tracking_no){
        var picking_code = $.trim($("#pickingCode", "#searchForm").val());
        $.ajax({
        type: "post",
        async: false,
        dataType: "script",
        url: "/shipment/picking/print-out-the-library-list/picking_code/"+picking_code+"/type/1/tracking_no/"+print_tracking_no,
        data: {
            "orderCodes": orderCode,
        },
        success: function (json) {
                print_lodop();
                recordPrintingLog(print_tracking_no, 'end');
            }
        });
    }


    //打印物料单
    function printBillOfMaterialsList(orderCode,print_tracking_no){
        var picking_code = $.trim($("#pickingCode", "#searchForm").val());
        $.ajax({
        type: "post",
        async: false,
        dataType: "script",
        url: "/shipment/picking/download-scan-form-bz/picking_code/"+picking_code+"/type/1/tracking_no/"+print_tracking_no,
        data: {
        "orderCodes": orderCode,
    },
        success: function (json) {
        print_lodop();
        recordPrintingLog(print_tracking_no, 'end');
    }
    });
    }


function fetchGetOtherDocumentsAttach(data, callbak) {
    $.ajax({
        type: "post",
        async: false,
        dataType: "json",
        url: "/shipment/picking/get-other-documents-attach",
        data: data,
        success: function (json) {
            callbak(json);
        }
    });
}

// 打印附件(发票+箱)
function printOtherDocumentsAttach(orderCode){
    fetchGetOtherDocumentsAttach({"orderCodes":orderCode}, function (json) {
        if (json.state == 1) {
            var imgList = json.imgList || [];
            var pdfList = json.pdfList || [];
            if (imgList.length > 0) {
                printOtherDocumentsAttachImg(imgList);
            }
            if (pdfList.length > 0) {
                printOtherDocumentsAttachPdf(pdfList);
            }
        }
    })
}
function printOtherDocumentsAttachImg(imgList) {
    $.ajax({
        type: "post",
        async: false,
        dataType: "script",
        url: "/shipment/picking/print-attach-img-list",
        data: {
            "imgList": JSON.stringify(imgList),
        },
        success: function (json) {
            print_lodop();
            //recordPrintingLog(print_tracking_no, 'end');
        }
    });
}

function printOtherDocumentsAttachPdf(pdfList) {
    $.ajax({
        type: "post",
        async: false,
        dataType: "script",
        url: "/shipment/picking/print-attach-pdf-list",
        data: {
            "pdfList": JSON.stringify(pdfList),
        },
        success: function (json) {
            print_lodop();
            //recordPrintingLog(print_tracking_no, 'end');
        }
    });
}


    //发送日本佐川标签数据
    function SendJapanLaberFile(orderCode,print_tracking_no=''){
        $.ajax({
            type: "post",
            async: false,
            dataType: "json",
            url: "/order/service-exception-orders/batch-send-file/source/1/picking_mode/1/api_log/"+print_tracking_no,
            data: {
                "order_code": orderCode,
            },
            success: function (json) {
                if(print_tracking_no =='') {
                    if (json.data.length > 0) {
                        $.each(json.data, function (key, val) {
                            recordPrintingLog(val.orderCode, val.channelCode+val.orderCode+val.trackNumber+val.fileUrl+val.file_name+val.callbackUrl);
                            pdfPrinter.upload_japan_file(val.channelCode, val.orderCode, val.trackNumber, val.fileUrl, val.file_name, val.callbackUrl);
                        });
                    }
                }
            }
        });
    }


</script>
<style type="text/css">
    .span_title {
        font-size: 14px;
        font-weight: bold;
    }

    .input_text {
        font-weight: bold;
    }
    .dialog-module td {
        padding: 3px 0;
    }

    .dialog-module input {
        width: 60%;
    }
    #operation-message{
        margin-left:75px;
        font-weight:bold;
        font-size:24px;
        background-color: #FDFFD2;
    }
    #autoDelivery-message{
        margin-left:84px;
        font-weight:bold;
        font-size:18px;
    }
    #autoDelivery-message .delivery-success{
        background-color:papayawhip;
    }
    #autoDelivery-message .delivery-fail{
       font-size:20px;
       color:red;
    }
    #pickingInfoPickingQty{
        text-decoration:underline;
    }
    .waitingDataQtyCss,.waitingDataSkuCss{
        font-weight:bold;
        font-size:24px;
    }

    ..waitingDataSkuCssNew{
        font-size:12px;
    }
    .scanInput {
        font-size: 16px;
        height: 32px;
    }
    #pickingInfoPickingQty,#pickingInfoPickingScanQty{
        font-size:38px;
        font-weight:bold;
    }
    .qtyCss {
        color: red;
    }
    .qtyScannedCss {
        color: blue;
    }
    .orderProductItem a {
        color:#0090e1;
    }
    .aPrintLabel a{
        color:#0090e1;
    }
    .search-module-condition{
        font-size: 17px;
        font-weight: bold;
    }
    .getPackOrdersLog td{
        word-wrap: break-word;
        word-break: normal;
    }
    .pack_operation_title{
        width:160px;
        text-align:right;
    }
    .search-module-condition div{
        float:left;
    }
    .check-button-div{
        position: absolute;
        margin-left: 490px;
        margin-top: -7px;
        font-size: 13px;
        border: 1px #a29b9b solid;
    }
    .check-button-div label{
        margin-left: 10px;
        margin-right: 10px;
        display: block;
    }
    .check-button-div-hidden{
        display: none;
    }
</style>

<script type="text/javascript">

    $(function () {
        if(language_special_styles.indexOf(locale_message_language) !== -1){
            $('.pack_operation_title').css('width','230px')
        }
    })

</script>
<object id="LODOP_OB" classid="clsid:2105C259-1E0C-4534-8141-A753534CB4CA" width="0" height="0">
    <embed id="LODOP_EM" type="application/x-print-lodop" width="0" height="0" pluginspage="/lodop/install_lodop32.exe">
</object>
<div style="display:none;">
    <audio src="#" id="autoplay" autoplay="autoplay">
        Your browser does not support the audio element.
    </audio>
</div>
<div id="module-container">
    <div style="display: none"><object id="EletronicToolsActive" classid="clsid:AB48C0CC-3BD7-4c82-A0EF-82A04B18A0D4"></object></div>

    <div class="search-module-condition">
        <div class="pack_operation_title">仓库：</div>
        <span id="selectedWarehouse">YZTUS02&nbsp;&nbsp;[云泽通US2号仓]</span>
        <input style="" type="button" onclick="setMainWarehouseDialog();" value="设置操作仓库" class="baseBtn" id="">
    </div>
    <form id="searchForm" name="searchForm" class="submitReturnFalse">
        <div id="search-module" style="overflow: visible;min-height: 200px;">
            <div id="product_outer_info"></div>
            <div id="freebies_packing" style="display: inline-block;float: right;color: red;font-size: 20px;"></div>
            <div style="width:70%;float:left;">
                <div id="printSet-tip"></div>
                <div id="pack-operation-area">
                                    <div class="search-module-condition">
                    <div class="pack_operation_title">拣货单号：</div>
                    <div>
                        <input type="text" placeholder="请扫描拣货单号" style="width:250px" name="pickingCode" id="pickingCode" class="input_text scanInput">&nbsp;
                        <label style="font-size:14px;">
                            <input type="checkbox" checked="" name="scanPickingCode" id="scanPickingCode" value="0">启用
                        </label>&nbsp;<input style="display:none" type="button" value="扫描" class="baseBtn submitPicking">
                        <label title="当订单完成配置时,自动打印物流标签" style="margin-left: 20px;"><input type="checkbox" checked="checked" name="isPrintLabel" id="isPrintLabel" value="1">打印标签</label>

                                                <a href="javascript:void(0)" id="check-button-div-show">更多...</a>
                        <div class="check-button-div check-button-div-hidden" id="check-button-div">
                            <label title="打印物料清单"><input type="checkbox" name="PrintBillOfMaterialsList" id="PrintBillOfMaterialsList" value="1">打印物料清单</label>


                                                        <label title="勾选云打印，需要提前打开或安装易仓打印助手">
                                <input type="checkbox" name="isPdfPrinter" id="isPdfPrinter" value="1">
                                云打印(出货标签)
                            </label>
                            
                            <label title="打印附件(发票+箱)" id="check-button-div-label"><input type="checkbox" name="PrintOtherDocumentsAttach" id="PrintOtherDocumentsAttach" value="1">打印附件(发票+箱)</label>

                        </div>
                    </div>
                    </div>
                <div class="search-module-condition" id="product_barcode_show">
                    <div class="pack_operation_title">产品代码：</div>
                    <div>
                        <input type="text" style="width:250px" name="productBarcode" id="productBarcode" class="input_text scanInput" placeholder="" data-sku-sanitizer-added="true">&nbsp;&nbsp;
                        <input type="button" value="确认" class="baseBtn submitProduct"><span class="remaining-info" style="margin-left: 8px; color: rgb(211, 47, 47); font-size: 12px;">(1)</span><label id="custom-error-label" class="custom-error-message" style="color: rgb(211, 47, 47); font-size: 18px; font-weight: bold; margin-left: 20px; display: inline; vertical-align: middle; font-family: Arial, sans-serif;">产品代码:PL22508050006 未找到匹配未完成的订单</label>
                    </div>
                </div>
                                <div class="search-module-condition">
                    <div class="pack_operation_title">订单包材：</div>
                    <div>
                        <input value="P000001" type="text" style="width:250px" name="packingCode" id="packingCode" class="input_text scanInput">&nbsp;&nbsp;
                        <input type="button" value="确认打包" class="baseBtn confirmPack">
                    </div>
                                    </div>
                    <div class="search-module-condition">
                        <div class="inline font_middle" style="line-height:32px;">
                            <div class="pack_operation_title">
                                <input type="checkbox" id="fixedPackage" class="font_middle" value="1">固定包材：
                            </div>
                            <select name="package_select" id="package_select" class="input_text2 selectCss2" data-placeholder="请选择" multiple="" style="display: none;">
                                                                <option value="BC002">BC002[包材]</option>
                                                            </select><div class="chosen-container chosen-container-multi" style="width: 345px;" title="" id="package_select_chosen"><ul class="chosen-choices"><li class="search-choice"><span>BC002[包材]</span><a class="search-choice-close" data-option-array-index="0"></a></li><li class="search-field"><input type="text" value="请选择" class="" autocomplete="off" style="width: 25px;"></li></ul><div class="chosen-drop"><ul class="chosen-results"></ul></div></div>
                        </div>
                    </div>

                    <div class="search-module-condition">
                        <span id="operation-message" style="color: rgb(255, 0, 0);"><span>SKU:[HYT-2-KAL25032402]&nbsp;&nbsp;HYT-250805-0137&nbsp;&nbsp;操作成功.&nbsp;&nbsp;<a href="javascript:void(0);getOrdersReprint(&quot;HYT-250805-0137&quot;);">重新打印</a></span>&nbsp;&nbsp;<a href="javascript:void(0);label_obtain(&quot;HYT-250805-0137&quot;);">重新获取标签</a></span>
                    </div>

                    <div class="search-module-condition" style="display:none;">
                        <div id="autoDelivery-message"></div>
                    </div>
                    <!-- 签出称重 NEW -->
                    <div id="weighting_ship_new_div" style="display:none;">
                        <div class="search-module-condition">
                            <div class="searchFilterText" style="width: 140px;line-height: 28px;">服务商渠道：</div>
                            <input type="text" class="input_text scanInput" name="ship_sm_code_new" id="ship_sm_code_new" readonly="readonly" style="width:250px">
                        </div>
                        <div class="search-module-condition">
                            <div class="searchFilterText" style="width: 140px;line-height: 28px;">订单号：</div>
                            <input type="text" class="input_text scanInput" name="ship_order_code_new" id="ship_order_code_new" readonly="readonly" style="width:250px">
                        </div>
                        <div class="search-module-condition">
                            <div class="searchFilterText" style="width: 140px;line-height: 28px;">跟踪号：</div>
                            <input type="text" class="input_text scanInput" name="ship_tracking_number_new" id="ship_tracking_number_new" style="width:250px">
                        </div>
                        <input type="hidden" value="0" name="vol_rate">
                                                <div class="search-module-condition">
                            <div class="searchFilterText" style="width: 140px;line-height: 28px;">系统重量：</div><!-- 重量 -->
                            <input name="o_weight" id="o_weight" type="text" value="" class="big-input">&nbsp;<b>KG</b>
                        </div>
                                                <div class="search-module-condition oneself_vol_weight measure_system measure_all" style="display:none;">
                            <div class="searchFilterText" style="width: 140px;line-height: 28px;">测量包裹(系统)：</div>
                            <!--系统-->
                            <input name="parcel_length" id="parcel_length_input" type="text" value="" class="parcel_measure input_text2 system_unit parcelLengthSys" data-type="1" data-unit_type="1" data-attr="parcelLength" placeholder="请输入包裹长">
                            <span class="symbol-change">x</span><input name="parcel_width" id="parcel_width_input" type="text" value="" class="parcel_measure input_text2 system_unit parcelWidthSys" data-type="1" data-unit_type="1" data-attr="parcelWidth" placeholder="请输入包裹宽">
                            <span class="symbol-change">x</span><input name="parcel_height" id="parcel_height_input" type="text" value="" class="parcel_measure input_text2 system_unit parcelHeightSys" data-type="1" data-unit_type="1" data-attr="parcelHeight" placeholder="请输入包裹高">
                            <b>CM</b>
                        </div>
                        <div class="search-module-condition oneself_vol_weight measure_warehouse measure_all" style="display:none;">
                            <div class="searchFilterText" style="width: 140px;line-height: 28px;">测量包裹(仓库)：</div>
                            <!--仓库-->
                            <input name="" id="parcel_length_input_wa" type="text" value="" class="parcel_measure input_text2 warehouse_unit parcelLength" data-type="2" data-unit_type="1" data-attr="parcelLengthSys" placeholder="请输入包裹长">
                            <span class="symbol-change">x</span><input name="" id="parcel_width_input_wa" type="text" value="" class="parcel_measure input_text2 warehouse_unit parcelWidth" data-type="2" data-unit_type="1" data-attr="parcelWidthSys" placeholder="请输入包裹宽">
                            <span class="symbol-change">x</span><input name="" id="parcel_height_input_wa" type="text" value="" class="parcel_measure input_text2 warehouse_unit parcelHeight" data-type="2" data-unit_type="1" data-attr="parcelHeightSys" placeholder="请输入包裹高">
                            <b class="warehouse_size_unit">CM</b>
                        </div>

                        <div class="search-module-condition oneself_vol_weight measure_warehouse measure_system" style="display: none;">
                            <div class="searchFilterText" style="width: 140px;line-height: 28px;">体积重(系统)：</div> <!-- 默认显示系统 体积重 -->
                            <!-- 默认显示系统 体积重 -->
                            <input name="parcel_vol_weight" id="parcel_vol_weight_input" type="hidden" value="0.000">
                            <span style="color: red;font-weight: bold;font-size: large" id="parcel_vol_weight">0.000</span>
                            <span style="color: red;font-weight: bold;font-size: large">(KG)</span><!--体积重显示:只要有仓库单位,则以仓库单位计算体积重显示:系统级别-->


                            <!--当配置 要显示 仓库单位 或者 两者都显示的话；带出 仓库 体积重-->
                            
                                                    </div>
                        <input type="hidden" name="is_force_new" id="is_force_new" value="0">
                        <div style="padding-left:40px;padding-top:10px">
                            <input type="button" value="订单出货" class="baseBtn submitShipOrder">
                        </div>
                    </div>
                    <!-- 签出称重 -->
                    <div id="weighting_ship_div" style="display:none;">
                        <div class="search-module-condition">
                            <div class="pack_operation_title">服务商渠道：</div>
                            <input type="text" class="input_text scanInput" name="ship_sm_code" id="ship_sm_code" readonly="readonly" style="width:250px">
                        </div>
                        <div class="search-module-condition">
                            <div class="pack_operation_title">订单号：</div>
                            <input type="text" class="input_text scanInput" name="ship_order_code" id="ship_order_code" readonly="readonly" style="width:250px">
                        </div>
                        <div class="search-module-condition">
                            <div class="pack_operation_title">跟踪号：</div>
                            <input type="text" class="input_text scanInput" name="ship_tracking_number" id="ship_tracking_number" style="width:250px">
                        </div>
                        <div class="search-module-condition">
                            <div class="pack_operation_title">重量：</div>
                            <input type="hidden" name="is_force" id="is_force" value="0">
                            <input type="hidden" name="is_focus_code" id="is_focus_code">
                            <input type="text" name="so_weight" id="so_weight" class="input_text scanInput" placeholder="" style="width:100px">&nbsp;Kg
                            <input type="button" value="订单出货" class="baseBtn submitShip">
                        </div>
                    </div>

                </div>
            </div>
            <div style="width: 35%; float: left; margin-top: 10px;" id="pickingInfo">
                <div class="search-module-condition">
                    <span class="span_title">拣货单号：</span><span id="pickingInfoPickingCode" style="font-size:16px"></span>
                    <span class="span_title" style="margin-left:30px">已扫描：</span>
                    <a href="javascript:void(0);" onclick="hadScanData();">
                         <span id="pickingInfoPickingScanQty" class="qtyScannedCss">665</span>
                    </a>



                    <span style="margin-left:30px" class="span_title">未扫描：</span>
                    <a href="javascript:void(0);" onclick="waitingData();">
                        <span id="pickingInfoPickingQty" class="qtyCss">396</span>
                    </a>
                </div>
                <div class="search-module-condition">
                    <span class="span_title">推荐包材：</span><span id="orderInfoPackName"></span>
                </div>
                <div class="search-module-condition" id="batchPackDiv" style="display: block;">
                    <span class="span_title">同款SKU还有 <input type="text" class="input_text" packingcode="" style="width:36px;font-weight:bold;" product_barcode="HYT-2-KAL25032402" qty="15" name="batchPackQty" value="" id="batchPackQty"> 订单</span>&nbsp;&nbsp;
                    <input type="button" class="baseBtn batchPack" value="批量打包">
                    <label style="font-size:14px;">
                        <input type="checkbox" id="batchPackConfirm" value="1" checked="">批量打包弹框确认
                    </label>
                </div>
                <div class="search-module-condition">
                    <span class="span_title">订单备注：</span><span id="order_no_remark">-</span>
                </div>
                <div class="search-module-condition">
                    <span class="span_title">店铺名称：</span><span id="shop_name">Urbelle</span>
                </div>
                <div class="search-module-condition">
                    <span class="span_title" style="font-size: 20px;color: red;">承运商：</span><span id="carriers_name" style="font-size: 20px;color: red;">-</span>
                </div>
            </div>

        </div>

        <div id="module-table">
            <div class="opration_area">
                <div class="opration_area_rit" style="margin-left:10px">
                    <input type="button" onclick="getPackOrdersLog();" class="baseBtn submitToSearch" value="打包记录">
                </div>
                <div class="opration_area_rit divOrderAttach" style="margin-left:10px;display:none">
                    <input type="button" value="下载附件" class="baseBtn orderAttach"><!-- 下载附件 -->
                </div>

                <div class="opration_area_rit" style="margin-left:10px;">
                    <input type="button" onclick="forceComplete();" class="baseBtn submitToSearch" value="完成拣货单">
                </div>
                <div class="opration_area_rit" style="margin-left:10px;">
                    <input type="button" value="设置打印机" class="baseBtn " onclick="printerSetup();">
                </div>
                <div class="opration_area_rit">
                    <input type="button" value="功能设置" class="baseBtn " onclick="function_settings();"><!-- 功能设置 -->
                </div>
            </div>
            <table width="100%" border="0" cellpadding="0" cellspacing="0" class="table-module">
                <tbody><tr class="table-module-title">
                    <td width="150">货品图片</td>
                    <td>产品代码</td>
                    <td>产品包材</td>
                    <td>自定义编码</td>
                    <td>产品名称</td>
                                    </tr>
                </tbody><tbody id="table-module-list-data"><tr class="table-module-b2 orderProductItem"><td class="ec-center"><img width="150" height="150" class="imgPreview22" src="/default/index/view-product-img/id/7401 "></td><td style="font-weight:bold;font-size:18px;" class="orderProduct_HYT-2-KAL25032402"><a href="javascript:void(0)" onclick="viewProductInfo(7401,&quot;HYT-2-KAL25032402&quot;)">HYT-2-KAL25032402</a></td><td style="font-weight:bold;font-size:18px;color: red;"></td><td style="font-weight:bold;font-size:18px;">2-KAL25032402</td><td style="font-weight:bold;font-size:18px;">身体乳</td></tr></tbody>
            </table>
        </div>
    </form>
<div class="to_top_div" data-show="false"><span style="float: left;cursor: pointer;padding: 0px 2px;" title="返回顶部" class="iconToTop" onclick="toTop();"></span><span style="float: left;cursor: pointer;padding: 0px 2px;" title="前往底部" class="iconToBottom" onclick="toBottom();"></span></div></div>
<!-- ############################################################################# -->
<!--未配货SKU-->

<!--已配货SKU-->



<!-- 让客户自行选择要打包的产品 -->





<div style="display:none;">
    <audio src="#" id="autoplay" autoplay="autoplay">
        Your browser does not support the audio element.
    </audio>
</div>
<!-- ############################################################################# -->



<!--功能设置-->


<!-- 标记问题件 -->
<script type="text/javascript">
    $(function(){
        //标记问题件
        $('#edit_exception_type').dialog({
            autoOpen: false,
            width: '500',
            height: 'auto',
            modal: true,
            show: "slide",
            buttons: [
                {
                    text: "打印",
                    id: "edit_exception_type_print_btn",
                    click: function () {
                        var orderCode=$("#order_code","#edit_exception_type_form").val();
                        printByCode(orderCode);
                    }
                },
                {
                    text: $.getMessage('confirm'),
                    click: function () {
                        var orgType=$("#org_order_exception_sub_type").val();
                        if($("#order_exception_sub_type").val()=='' && (orgType=='' || orgType=='0')){
                            $('#validateTips').text('请选择异常类型').show();
                            return;
                        }
                        $.ajax({
                            type: "POST",
                            async: false,
                            dataType: "json",
                            url: '/order/orders-exception/mark-abnormal',
                            data: {
                                orderCode: $("#order_code","#edit_exception_type_form").val(),
                                type: $("#order_exception_sub_type","#edit_exception_type_form").val(),
                                note: $.trim($("#reason").val()),
                                app: 0
                            },
                            success: function (json) {
                                if(json.ask=='1') {
                                    $('#edit_exception_type').dialog("close");
                                    var tips="<span class='tip-success-message'>"+json.message+"</span>";

                                    alertConfirmTipNew(tips,function(){
                                        reloadData('');
                                        problemOrderPrinting(json.data);//当前订单标记问题件成功后就询问是否打印问题件信息（lixichu add）
                                    });
                                }else {
                                    $('#validateTips').text(json.message).show();
                                }
                            }
                        });
                    }
                },
                {
                    text: $.getMessage('cancel'),
                    click: function () {
                        $(this).dialog("close");
                    }
                }],open: function () {
                var type = $("#org_order_exception_sub_type").val();
                if (type!= '' && type != '0') {
                    $("#edit_exception_type_print_btn").show();
                } else {
                    $("#edit_exception_type_print_btn").hide();
                }
            }
        });
    });


    function editExceptionType(code) {
        $("#reason").val('');
        $('#validateTips').text('').hide();
        var uri = '/order/orders-exception/get-orders';
        $.get(uri, {
            orderCode:code
        }, function(json){
            if(json.ask===0){
                alertTip('<span class="tip-error-message">'+json.message+'</span>');
            }
            else {
                $("#order_id","#edit_exception_type_form").val(json.data.order_id);
                $("#order_code","#edit_exception_type_form").val(json.data.order_code);
                $("#orderCode","#edit_exception_type_form").html(json.data.order_code);
                $("#order_exception_sub_type","#edit_exception_type_form").val(json.data.order_exception_sub_type);
                $("#org_order_exception_sub_type","#edit_exception_type_form").val(json.data.order_exception_sub_type);
                $("#edit_exception_type").dialog("open");
            }
        },'json');
    }

    //问题件订单打印（lixichu add）
    function problemOrderPrinting(order_code){
        alertConfirmTip("是否打印当前问题件信息吗？",function(){
            $.ajax({
                type: 'POST',
                async: false,
                url: '/order/orders-exception/problem-order-printing',
                data: {
                    codeStr:order_code
                },
                dataType:'script',
                success: function(res){
                    print_lodop();
                }
            });
        });

    }


    //打印
    function printByCode(codeStr){
        $.ajax({
            type: "POST",
            async: false,
            url: "/order/orders-exception/print-batch-script",
            data: {
                codeStr:codeStr
            },
            dataType: 'script',
            success: function (msg) {
                print_lodop();
            }
        });
    }


    function alertConfirmTipNew(tip,callBack,width,height) {
        width = width ? width : 400;
        height = height ? height : 500;
        $('<div title="操作提示" id="dialog-auto-alertConfirm-tip"><p align="">' + tip + '</p></div>').dialog({
            autoOpen: true,
            width: width,
            maxHeight: height,
            modal: true,
            show: "slide",
            buttons: [
                {
                    text: $.getMessage('confirm'),
                    click: function () {
                        $(this).dialog("close");
                        callBack();
                    }
                },
                {
                    text: $.getMessage('cancel'),
                    click: function () {
                        $(this).dialog("close");
                        callBack();
                    }
                }
            ],
            close: function () {
                $(this).detach();
            }
        });
    }

</script>
<style type="text/css">
    .dialog-module-title{
        width:130px;
        text-align:right;
    }
    .validateTips{
        color:red;
        font-weight:bold;
        font-size:16px;
    }
    .exceptionOrderCode{
        font-weight:bold;
        font-size:14px;
    }
    .orderExceptionSubType{
        color:red;
        font-weight:bold;
        font-size:14px;
    }
</style>

<script type="text/javascript" src="/js/jquery-cookie.js?v=stable-12.7.23"></script>
<script type="text/javascript" src="/js/jquery.form.js?v=stable-12.7.23"></script>
<script type="text/javascript" src="/js/jquery.pagination.js?v=stable-12.7.23"></script>
<script type="text/javascript" src="/js/mod.js?v=stable-12.7.23"></script>
<script type="text/javascript" src="/js/searchFilter.js?v=stable-12.7.23"></script>
<script type="text/javascript" src="/js/jquery.myLoading.js?v=stable-12.7.23"></script>
<script type="text/javascript" src="/js/common.js?20170125&amp;v=stable-12.7.23"></script>
<script>
    if(language_special_styles.indexOf(locale_message_language) !== -1){
        $('.searchFilterText').attr('style', function (i, s) {return (s + ';min-width: 220px !important;')});
    }
</script>


<div class="ui-dialog ui-widget ui-widget-content ui-corner-all ui-front ui-dialog-buttons ui-draggable ui-resizable" tabindex="-1" role="dialog" aria-describedby="waitingDataDialog" aria-labelledby="ui-id-1" style="display: none; position: absolute;"><div class="ui-dialog-titlebar ui-widget-header ui-corner-all ui-helper-clearfix"><span id="ui-id-1" class="ui-dialog-title">未配货</span><button class="ui-button ui-widget ui-state-default ui-corner-all ui-button-icon-only ui-dialog-titlebar-close" role="button" aria-disabled="false" title="close"><span class="ui-button-icon-primary ui-icon ui-icon-closethick"></span><span class="ui-button-text">close</span></button></div><div id="waitingDataDialog" style="width: 600px;" class="ui-dialog-content ui-widget-content">
    <table width="100%" border="0" cellpadding="0" cellspacing="0" class="table-module">
        <tbody><tr class="table-module-title" style="text-align: center;">
            <td width="18" class="ec-center">NO.</td>
            <td width="60">产品图片</td>
            <td width="180">产品代码</td>
            <td width="100">自定义编码</td>
            <td width="60">未配数</td>
        </tr>
        </tbody><tbody id="waiting-list-data">

        </tbody>
    </table>
</div><div class="ui-dialog-buttonpane ui-widget-content ui-helper-clearfix"><div class="ui-dialog-buttonset"><button type="button" class="ui-button ui-widget ui-state-default ui-corner-all ui-button-text-only" role="button" aria-disabled="false"><span class="ui-button-text">关闭</span></button></div></div><div class="ui-resizable-handle ui-resizable-n" style="z-index: 90;"></div><div class="ui-resizable-handle ui-resizable-e" style="z-index: 90;"></div><div class="ui-resizable-handle ui-resizable-s" style="z-index: 90;"></div><div class="ui-resizable-handle ui-resizable-w" style="z-index: 90;"></div><div class="ui-resizable-handle ui-resizable-se ui-icon ui-icon-gripsmall-diagonal-se" style="z-index: 90;"></div><div class="ui-resizable-handle ui-resizable-sw" style="z-index: 90;"></div><div class="ui-resizable-handle ui-resizable-ne" style="z-index: 90;"></div><div class="ui-resizable-handle ui-resizable-nw" style="z-index: 90;"></div></div><div class="ui-dialog ui-widget ui-widget-content ui-corner-all ui-front ui-dialog-buttons ui-draggable ui-resizable" tabindex="-1" role="dialog" aria-describedby="hadScanDataDialog" aria-labelledby="ui-id-2" style="display: none; position: absolute;"><div class="ui-dialog-titlebar ui-widget-header ui-corner-all ui-helper-clearfix"><span id="ui-id-2" class="ui-dialog-title">已扫描数</span><button class="ui-button ui-widget ui-state-default ui-corner-all ui-button-icon-only ui-dialog-titlebar-close" role="button" aria-disabled="false" title="close"><span class="ui-button-icon-primary ui-icon ui-icon-closethick"></span><span class="ui-button-text">close</span></button></div><div id="hadScanDataDialog" style="width: 600px;" class="ui-dialog-content ui-widget-content">
    <table width="100%" border="0" cellpadding="0" cellspacing="0" class="table-module">
        <tbody><tr class="table-module-title" style="text-align: center;">
            <td width="30" class="ec-center">NO.</td>
            <td width="150" class="ec-center">产品代码</td>
            <td width="150" class="ec-center">订单号</td>
            <td width="150" class="ec-center">序列号</td>
            <td width="60" class="ec-center">已扫描数</td>
        </tr>
        </tbody><tbody id="had-scan-list-data">

        </tbody>
    </table>
</div><div class="ui-dialog-buttonpane ui-widget-content ui-helper-clearfix"><div class="ui-dialog-buttonset"><button type="button" class="ui-button ui-widget ui-state-default ui-corner-all ui-button-text-only" role="button" aria-disabled="false"><span class="ui-button-text">关闭</span></button></div></div><div class="ui-resizable-handle ui-resizable-n" style="z-index: 90;"></div><div class="ui-resizable-handle ui-resizable-e" style="z-index: 90;"></div><div class="ui-resizable-handle ui-resizable-s" style="z-index: 90;"></div><div class="ui-resizable-handle ui-resizable-w" style="z-index: 90;"></div><div class="ui-resizable-handle ui-resizable-se ui-icon ui-icon-gripsmall-diagonal-se" style="z-index: 90;"></div><div class="ui-resizable-handle ui-resizable-sw" style="z-index: 90;"></div><div class="ui-resizable-handle ui-resizable-ne" style="z-index: 90;"></div><div class="ui-resizable-handle ui-resizable-nw" style="z-index: 90;"></div></div><div class="ui-dialog ui-widget ui-widget-content ui-corner-all ui-front ui-dialog-buttons ui-draggable ui-resizable" tabindex="-1" role="dialog" aria-describedby="waitingPickingSkuDialog" aria-labelledby="ui-id-3" style="display: none; position: absolute;"><div class="ui-dialog-titlebar ui-widget-header ui-corner-all ui-helper-clearfix"><span id="ui-id-3" class="ui-dialog-title">选择打包产品</span><button class="ui-button ui-widget ui-state-default ui-corner-all ui-button-icon-only ui-dialog-titlebar-close" role="button" aria-disabled="false" title="close"><span class="ui-button-icon-primary ui-icon ui-icon-closethick"></span><span class="ui-button-text">close</span></button></div><div id="waitingPickingSkuDialog" style="width: 600px;" class="ui-dialog-content ui-widget-content">
    <table width="100%" border="0" cellpadding="0" cellspacing="0" class="table-module">
        <tbody><tr class="table-module-title" style="text-align: center;">
            <td width="30" class="ec-center">NO.</td>
            <td width="100">客户代码</td>
            <td width="180">sku</td>
            <td width="200">产品代码</td>
            <td width="60">请选择</td>
        </tr>
        <input type="hidden" id="pickingProductBarcode">
        </tbody><tbody id="waiting-picking-sku-data">

        </tbody>
    </table>
</div><div class="ui-dialog-buttonpane ui-widget-content ui-helper-clearfix"><div class="ui-dialog-buttonset"><button type="button" class="ui-button ui-widget ui-state-default ui-corner-all ui-button-text-only" role="button" aria-disabled="false"><span class="ui-button-text">取消</span></button><button type="button" class="ui-button ui-widget ui-state-default ui-corner-all ui-button-text-only" role="button" aria-disabled="false"><span class="ui-button-text">确认</span></button></div></div><div class="ui-resizable-handle ui-resizable-n" style="z-index: 90;"></div><div class="ui-resizable-handle ui-resizable-e" style="z-index: 90;"></div><div class="ui-resizable-handle ui-resizable-s" style="z-index: 90;"></div><div class="ui-resizable-handle ui-resizable-w" style="z-index: 90;"></div><div class="ui-resizable-handle ui-resizable-se ui-icon ui-icon-gripsmall-diagonal-se" style="z-index: 90;"></div><div class="ui-resizable-handle ui-resizable-sw" style="z-index: 90;"></div><div class="ui-resizable-handle ui-resizable-ne" style="z-index: 90;"></div><div class="ui-resizable-handle ui-resizable-nw" style="z-index: 90;"></div></div><div class="ui-dialog ui-widget ui-widget-content ui-corner-all ui-front ui-dialog-buttons ui-draggable ui-resizable" tabindex="-1" role="dialog" aria-describedby="function_settings_dialog" aria-labelledby="ui-id-4" style="position: absolute; height: auto; width: 650px; top: 492px; left: 890.5px; display: none;"><div class="ui-dialog-titlebar ui-widget-header ui-corner-all ui-helper-clearfix"><span id="ui-id-4" class="ui-dialog-title">功能设置</span><button class="ui-button ui-widget ui-state-default ui-corner-all ui-button-icon-only ui-dialog-titlebar-close" role="button" aria-disabled="false" title="close"><span class="ui-button-icon-primary ui-icon ui-icon-closethick"></span><span class="ui-button-text">close</span></button></div><div id="function_settings_dialog" style="width: auto; min-height: 35px; max-height: none; height: auto;" class="ui-dialog-content ui-widget-content">
    <div style="padding-left: 20px; padding-top: 10px;">
        <label>
            <input type="checkbox" name="is_print_on_package_to_order" id="is_print_on_package_to_order" value="1">
            <span>不自动勾选打印标签</span>
        </label>
        <img src="/images/header/help.png" style="cursor: pointer" title=" 勾选则所有仓库进入打包页面时，打印标签不勾选">
    </div>
    <div style="padding-left: 20px; padding-top: 10px;">
        <label>
            <input type="checkbox" name="is_serial_number_checked" id="is_serial_number_checked" value="1">
            <span>序列号出库(支持不用扫描产品代码，直接扫描序列号打包)</span>
        </label>
    </div>
</div><div class="ui-resizable-handle ui-resizable-n" style="z-index: 90;"></div><div class="ui-resizable-handle ui-resizable-e" style="z-index: 90;"></div><div class="ui-resizable-handle ui-resizable-s" style="z-index: 90;"></div><div class="ui-resizable-handle ui-resizable-w" style="z-index: 90;"></div><div class="ui-resizable-handle ui-resizable-se ui-icon ui-icon-gripsmall-diagonal-se" style="z-index: 90;"></div><div class="ui-resizable-handle ui-resizable-sw" style="z-index: 90;"></div><div class="ui-resizable-handle ui-resizable-ne" style="z-index: 90;"></div><div class="ui-resizable-handle ui-resizable-nw" style="z-index: 90;"></div><div class="ui-dialog-buttonpane ui-widget-content ui-helper-clearfix"><div class="ui-dialog-buttonset"><button type="button" class="ui-button ui-widget ui-state-default ui-corner-all ui-button-text-only" role="button" aria-disabled="false"><span class="ui-button-text">确认</span></button><button type="button" class="ui-button ui-widget ui-state-default ui-corner-all ui-button-text-only" role="button" aria-disabled="false"><span class="ui-button-text">关闭</span></button></div></div></div><div class="ui-dialog ui-widget ui-widget-content ui-corner-all ui-front ui-dialog-buttons ui-draggable ui-resizable" tabindex="-1" role="dialog" aria-describedby="edit_exception_type" aria-labelledby="ui-id-5" style="display: none; position: absolute;"><div class="ui-dialog-titlebar ui-widget-header ui-corner-all ui-helper-clearfix"><span id="ui-id-5" class="ui-dialog-title">编辑异常类型</span><button class="ui-button ui-widget ui-state-default ui-corner-all ui-button-icon-only ui-dialog-titlebar-close" role="button" aria-disabled="false" title="close"><span class="ui-button-icon-primary ui-icon ui-icon-closethick"></span><span class="ui-button-text">close</span></button></div><div id="edit_exception_type" style="" class="ui-dialog-content ui-widget-content">
    <form id="edit_exception_type_form" name="edit_exception_type_form" class="submitReturnFalse my-ajax-form">
        <input type="hidden" name="order_id" id="order_id" value="">
        <input type="hidden" name="order_code" id="order_code" value="">
        <input type="hidden" name="org_order_exception_sub_type" id="org_order_exception_sub_type" value="">
        <table class="dialog-module" border="0" cellpadding="0" cellspacing="0">
            <tbody>
            <tr>
                <td class="dialog-module-title">订单号：</td>
                <td id="orderCode" class="exceptionOrderCode"></td>
            </tr>
            <tr>
                <td class="dialog-module-title">异常子类型：</td>
                <td>
                    <select class="input_text2 keyToSearch " id="order_exception_sub_type" name="order_exception_sub_type"><option value="">无</option><option value="2">实物库存不足</option>
<option value="3">包裹已超重无法签出(需要更换渠道)</option>
<option value="5">其他</option>
<option value="6">其他</option>
</select>
                </td>
            </tr>
            <tr>
                <td class="dialog-module-title">原因：</td><!-- 原因 -->
                <td><textarea id="reason" name="reason" cols="35" rows="3"></textarea></td>
            </tr>
            </tbody>
        </table>
    </form>
    <div class="validateTips" id="validateTips"></div>
</div><div class="ui-dialog-buttonpane ui-widget-content ui-helper-clearfix"><div class="ui-dialog-buttonset"><button type="button" id="edit_exception_type_print_btn" class="ui-button ui-widget ui-state-default ui-corner-all ui-button-text-only" role="button" aria-disabled="false"><span class="ui-button-text">打印</span></button><button type="button" class="ui-button ui-widget ui-state-default ui-corner-all ui-button-text-only" role="button" aria-disabled="false"><span class="ui-button-text">确认</span></button><button type="button" class="ui-button ui-widget ui-state-default ui-corner-all ui-button-text-only" role="button" aria-disabled="false"><span class="ui-button-text">取消</span></button></div></div><div class="ui-resizable-handle ui-resizable-n" style="z-index: 90;"></div><div class="ui-resizable-handle ui-resizable-e" style="z-index: 90;"></div><div class="ui-resizable-handle ui-resizable-s" style="z-index: 90;"></div><div class="ui-resizable-handle ui-resizable-w" style="z-index: 90;"></div><div class="ui-resizable-handle ui-resizable-se ui-icon ui-icon-gripsmall-diagonal-se" style="z-index: 90;"></div><div class="ui-resizable-handle ui-resizable-sw" style="z-index: 90;"></div><div class="ui-resizable-handle ui-resizable-ne" style="z-index: 90;"></div><div class="ui-resizable-handle ui-resizable-nw" style="z-index: 90;"></div></div><div id="preview_div"></div><div class="ui-dialog ui-widget ui-widget-content ui-corner-all ui-front ui-dialog-buttons ui-draggable ui-resizable" tabindex="-1" role="dialog" aria-describedby="dialog-auto-alert-tip" aria-labelledby="ui-id-6" style="position: absolute; height: auto; width: 400px; top: 0px; left: 1015.5px; display: none;"><div class="ui-dialog-titlebar ui-widget-header ui-corner-all ui-helper-clearfix"><span id="ui-id-6" class="ui-dialog-title">操作提示</span><button class="ui-button ui-widget ui-state-default ui-corner-all ui-button-icon-only ui-dialog-titlebar-close" role="button" aria-disabled="false" title="close"><span class="ui-button-icon-primary ui-icon ui-icon-closethick"></span><span class="ui-button-text">close</span></button></div><div class="ui-dialog-buttonpane ui-widget-content ui-helper-clearfix"><div class="ui-dialog-buttonset"><button type="button" class="ui-button ui-widget ui-state-default ui-corner-all ui-button-text-only" role="button" aria-disabled="false"><span class="ui-button-text">关闭</span></button></div></div><div class="ui-resizable-handle ui-resizable-n" style="z-index: 90;"></div><div class="ui-resizable-handle ui-resizable-e" style="z-index: 90;"></div><div class="ui-resizable-handle ui-resizable-s" style="z-index: 90;"></div><div class="ui-resizable-handle ui-resizable-w" style="z-index: 90;"></div><div class="ui-resizable-handle ui-resizable-se ui-icon ui-icon-gripsmall-diagonal-se" style="z-index: 90;"></div><div class="ui-resizable-handle ui-resizable-sw" style="z-index: 90;"></div><div class="ui-resizable-handle ui-resizable-ne" style="z-index: 90;"></div><div class="ui-resizable-handle ui-resizable-nw" style="z-index: 90;"></div></div></body></html>